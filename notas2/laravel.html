<!doctype html>
<head>
	<meta charset="utf-8">
	<title>Markdown preview</title>
	<meta name="author" content="@Stolz">

	<style>#styles a{display:inline-block;padding:0 .3em}</style>
	<link id="style" rel="stylesheet" type="text/css" media="screen" href="" />

	<script>
		/* Zepto v1.0-1-ga3cab6c - polyfill zepto detect event ajax form fx - zeptojs.com/license */
		(function(a){String.prototype.trim===a&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.reduce===a&&(Array.prototype.reduce=function(b){if(this===void 0||this===null)throw new TypeError;var c=Object(this),d=c.length>>>0,e=0,f;if(typeof b!="function")throw new TypeError;if(d==0&&arguments.length==1)throw new TypeError;if(arguments.length>=2)f=arguments[1];else do{if(e in c){f=c[e++];break}if(++e>=d)throw new TypeError}while(!0);while(e<d)e in c&&(f=b.call(a,f,c[e],e,c)),e++;return f})})();var Zepto=function(){function E(a){return a==null?String(a):y[z.call(a)]||"object"}function F(a){return E(a)=="function"}function G(a){return a!=null&&a==a.window}function H(a){return a!=null&&a.nodeType==a.DOCUMENT_NODE}function I(a){return E(a)=="object"}function J(a){return I(a)&&!G(a)&&a.__proto__==Object.prototype}function K(a){return a instanceof Array}function L(a){return typeof a.length=="number"}function M(a){return g.call(a,function(a){return a!=null})}function N(a){return a.length>0?c.fn.concat.apply([],a):a}function O(a){return a.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function P(a){return a in j?j[a]:j[a]=new RegExp("(^|\\s)"+a+"(\\s|$)")}function Q(a,b){return typeof b=="number"&&!l[O(a)]?b+"px":b}function R(a){var b,c;return i[a]||(b=h.createElement(a),h.body.appendChild(b),c=k(b,"").getPropertyValue("display"),b.parentNode.removeChild(b),c=="none"&&(c="block"),i[a]=c),i[a]}function S(a){return"children"in a?f.call(a.children):c.map(a.childNodes,function(a){if(a.nodeType==1)return a})}function T(c,d,e){for(b in d)e&&(J(d[b])||K(d[b]))?(J(d[b])&&!J(c[b])&&(c[b]={}),K(d[b])&&!K(c[b])&&(c[b]=[]),T(c[b],d[b],e)):d[b]!==a&&(c[b]=d[b])}function U(b,d){return d===a?c(b):c(b).filter(d)}function V(a,b,c,d){return F(b)?b.call(a,c,d):b}function W(a,b,c){c==null?a.removeAttribute(b):a.setAttribute(b,c)}function X(b,c){var d=b.className,e=d&&d.baseVal!==a;if(c===a)return e?d.baseVal:d;e?d.baseVal=c:b.className=c}function Y(a){var b;try{return a?a=="true"||(a=="false"?!1:a=="null"?null:isNaN(b=Number(a))?/^[\[\{]/.test(a)?c.parseJSON(a):a:b):a}catch(d){return a}}function Z(a,b){b(a);for(var c in a.childNodes)Z(a.childNodes[c],b)}var a,b,c,d,e=[],f=e.slice,g=e.filter,h=window.document,i={},j={},k=h.defaultView.getComputedStyle,l={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},m=/^\s*<(\w+|!)[^>]*>/,n=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,o=/^(?:body|html)$/i,p=["val","css","html","text","data","width","height","offset"],q=["after","prepend","before","append"],r=h.createElement("table"),s=h.createElement("tr"),t={tr:h.createElement("tbody"),tbody:r,thead:r,tfoot:r,td:s,th:s,"*":h.createElement("div")},u=/complete|loaded|interactive/,v=/^\.([\w-]+)$/,w=/^#([\w-]*)$/,x=/^[\w-]+$/,y={},z=y.toString,A={},B,C,D=h.createElement("div");return A.matches=function(a,b){if(!a||a.nodeType!==1)return!1;var c=a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.matchesSelector;if(c)return c.call(a,b);var d,e=a.parentNode,f=!e;return f&&(e=D).appendChild(a),d=~A.qsa(e,b).indexOf(a),f&&D.removeChild(a),d},B=function(a){return a.replace(/-+(.)?/g,function(a,b){return b?b.toUpperCase():""})},C=function(a){return g.call(a,function(b,c){return a.indexOf(b)==c})},A.fragment=function(b,d,e){b.replace&&(b=b.replace(n,"<$1></$2>")),d===a&&(d=m.test(b)&&RegExp.$1),d in t||(d="*");var g,h,i=t[d];return i.innerHTML=""+b,h=c.each(f.call(i.childNodes),function(){i.removeChild(this)}),J(e)&&(g=c(h),c.each(e,function(a,b){p.indexOf(a)>-1?g[a](b):g.attr(a,b)})),h},A.Z=function(a,b){return a=a||[],a.__proto__=c.fn,a.selector=b||"",a},A.isZ=function(a){return a instanceof A.Z},A.init=function(b,d){if(!b)return A.Z();if(F(b))return c(h).ready(b);if(A.isZ(b))return b;var e;if(K(b))e=M(b);else if(I(b))e=[J(b)?c.extend({},b):b],b=null;else if(m.test(b))e=A.fragment(b.trim(),RegExp.$1,d),b=null;else{if(d!==a)return c(d).find(b);e=A.qsa(h,b)}return A.Z(e,
b)},c=function(a,b){return A.init(a,b)},c.extend=function(a){var b,c=f.call(arguments,1);return typeof a=="boolean"&&(b=a,a=c.shift()),c.forEach(function(c){T(a,c,b)}),a},A.qsa=function(a,b){var c;return H(a)&&w.test(b)?(c=a.getElementById(RegExp.$1))?[c]:[]:a.nodeType!==1&&a.nodeType!==9?[]:f.call(v.test(b)?a.getElementsByClassName(RegExp.$1):x.test(b)?a.getElementsByTagName(b):a.querySelectorAll(b))},c.contains=function(a,b){return a!==b&&a.contains(b)},c.type=E,c.isFunction=F,c.isWindow=G,c.isArray=K,c.isPlainObject=J,c.isEmptyObject=function(a){var b;for(b in a)return!1;return!0},c.inArray=function(a,b,c){return e.indexOf.call(b,a,c)},c.camelCase=B,c.trim=function(a){return a.trim()},c.uuid=0,c.support={},c.expr={},c.map=function(a,b){var c,d=[],e,f;if(L(a))for(e=0;e<a.length;e++)c=b(a[e],e),c!=null&&d.push(c);else for(f in a)c=b(a[f],f),c!=null&&d.push(c);return N(d)},c.each=function(a,b){var c,d;if(L(a)){for(c=0;c<a.length;c++)if(b.call(a[c],c,a[c])===!1)return a}else for(d in a)if(b.call(a[d],d,a[d])===!1)return a;return a},c.grep=function(a,b){return g.call(a,b)},window.JSON&&(c.parseJSON=JSON.parse),c.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){y["[object "+b+"]"]=b.toLowerCase()}),c.fn={forEach:e.forEach,reduce:e.reduce,push:e.push,sort:e.sort,indexOf:e.indexOf,concat:e.concat,map:function(a){return c(c.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return c(f.apply(this,arguments))},ready:function(a){return u.test(h.readyState)?a(c):h.addEventListener("DOMContentLoaded",function(){a(c)},!1),this},get:function(b){return b===a?f.call(this):this[b>=0?b:b+this.length]},toArray:function(){return this.get()},size:function(){return this.length},remove:function(){return this.each(function(){this.parentNode!=null&&this.parentNode.removeChild(this)})},each:function(a){return e.every.call(this,function(b,c){return a.call(b,c,b)!==!1}),this},filter:function(a){return F(a)?this.not(this.not(a)):c(g.call(this,function(b){return A.matches(b,a)}))},add:function(a,b){return c(C(this.concat(c(a,b))))},is:function(a){return this.length>0&&A.matches(this[0],a)},not:function(b){var d=[];if(F(b)&&b.call!==a)this.each(function(a){b.call(this,a)||d.push(this)});else{var e=typeof b=="string"?this.filter(b):L(b)&&F(b.item)?f.call(b):c(b);this.forEach(function(a){e.indexOf(a)<0&&d.push(a)})}return c(d)},has:function(a){return this.filter(function(){return I(a)?c.contains(this,a):c(this).find(a).size()})},eq:function(a){return a===-1?this.slice(a):this.slice(a,+a+1)},first:function(){var a=this[0];return a&&!I(a)?a:c(a)},last:function(){var a=this[this.length-1];return a&&!I(a)?a:c(a)},find:function(a){var b,d=this;return typeof a=="object"?b=c(a).filter(function(){var a=this;return e.some.call(d,function(b){return c.contains(b,a)})}):this.length==1?b=c(A.qsa(this[0],a)):b=this.map(function(){return A.qsa(this,a)}),b},closest:function(a,b){var d=this[0],e=!1;typeof a=="object"&&(e=c(a));while(d&&!(e?e.indexOf(d)>=0:A.matches(d,a)))d=d!==b&&!H(d)&&d.parentNode;return c(d)},parents:function(a){var b=[],d=this;while(d.length>0)d=c.map(d,function(a){if((a=a.parentNode)&&!H(a)&&b.indexOf(a)<0)return b.push(a),a});return U(b,a)},parent:function(a){return U(C(this.pluck("parentNode")),a)},children:function(a){return U(this.map(function(){return S(this)}),a)},contents:function(){return this.map(function(){return f.call(this.childNodes)})},siblings:function(a){return U(this.map(function(a,b){return g.call(S(b.parentNode),function(a){return a!==b})}),a)},empty:function(){return this.each(function(){this.innerHTML=""})},pluck:function(a){return c.map(this,function(b){return b[a]})},show:function(){return this.each(function(){this.style.display=="none"&&(this.style.display=null),k(this,"").getPropertyValue("display")=="none"&&(this.style.display=R(this.nodeName))})},replaceWith:function(a){return this.before(a).remove()},wrap:function(a){var b=F(a);if(this[0]&&!b)var d=c(a).get(0),e=d.parentNode||this.length>1;return this.each(function(f){c(this).wrapAll(b?a.call(this,f):e?d.
cloneNode(!0):d)})},wrapAll:function(a){if(this[0]){c(this[0]).before(a=c(a));var b;while((b=a.children()).length)a=b.first();c(a).append(this)}return this},wrapInner:function(a){var b=F(a);return this.each(function(d){var e=c(this),f=e.contents(),g=b?a.call(this,d):a;f.length?f.wrapAll(g):e.append(g)})},unwrap:function(){return this.parent().each(function(){c(this).replaceWith(c(this).children())}),this},clone:function(){return this.map(function(){return this.cloneNode(!0)})},hide:function(){return this.css("display","none")},toggle:function(b){return this.each(function(){var d=c(this);(b===a?d.css("display")=="none":b)?d.show():d.hide()})},prev:function(a){return c(this.pluck("previousElementSibling")).filter(a||"*")},next:function(a){return c(this.pluck("nextElementSibling")).filter(a||"*")},html:function(b){return b===a?this.length>0?this[0].innerHTML:null:this.each(function(a){var d=this.innerHTML;c(this).empty().append(V(this,b,a,d))})},text:function(b){return b===a?this.length>0?this[0].textContent:null:this.each(function(){this.textContent=b})},attr:function(c,d){var e;return typeof c=="string"&&d===a?this.length==0||this[0].nodeType!==1?a:c=="value"&&this[0].nodeName=="INPUT"?this.val():!(e=this[0].getAttribute(c))&&c in this[0]?this[0][c]:e:this.each(function(a){if(this.nodeType!==1)return;if(I(c))for(b in c)W(this,b,c[b]);else W(this,c,V(this,d,a,this.getAttribute(c)))})},removeAttr:function(a){return this.each(function(){this.nodeType===1&&W(this,a)})},prop:function(b,c){return c===a?this[0]&&this[0][b]:this.each(function(a){this[b]=V(this,c,a,this[b])})},data:function(b,c){var d=this.attr("data-"+O(b),c);return d!==null?Y(d):a},val:function(b){return b===a?this[0]&&(this[0].multiple?c(this[0]).find("option").filter(function(a){return this.selected}).pluck("value"):this[0].value):this.each(function(a){this.value=V(this,b,a,this.value)})},offset:function(a){if(a)return this.each(function(b){var d=c(this),e=V(this,a,b,d.offset()),f=d.offsetParent().offset(),g={top:e.top-f.top,left:e.left-f.left};d.css("position")=="static"&&(g.position="relative"),d.css(g)});if(this.length==0)return null;var b=this[0].getBoundingClientRect();return{left:b.left+window.pageXOffset,top:b.top+window.pageYOffset,width:Math.round(b.width),height:Math.round(b.height)}},css:function(a,c){if(arguments.length<2&&typeof a=="string")return this[0]&&(this[0].style[B(a)]||k(this[0],"").getPropertyValue(a));var d="";if(E(a)=="string")!c&&c!==0?this.each(function(){this.style.removeProperty(O(a))}):d=O(a)+":"+Q(a,c);else for(b in a)!a[b]&&a[b]!==0?this.each(function(){this.style.removeProperty(O(b))}):d+=O(b)+":"+Q(b,a[b])+";";return this.each(function(){this.style.cssText+=";"+d})},index:function(a){return a?this.indexOf(c(a)[0]):this.parent().children().indexOf(this[0])},hasClass:function(a){return e.some.call(this,function(a){return this.test(X(a))},P(a))},addClass:function(a){return this.each(function(b){d=[];var e=X(this),f=V(this,a,b,e);f.split(/\s+/g).forEach(function(a){c(this).hasClass(a)||d.push(a)},this),d.length&&X(this,e+(e?" ":"")+d.join(" "))})},removeClass:function(b){return this.each(function(c){if(b===a)return X(this,"");d=X(this),V(this,b,c,d).split(/\s+/g).forEach(function(a){d=d.replace(P(a)," ")}),X(this,d.trim())})},toggleClass:function(b,d){return this.each(function(e){var f=c(this),g=V(this,b,e,X(this));g.split(/\s+/g).forEach(function(b){(d===a?!f.hasClass(b):d)?f.addClass(b):f.removeClass(b)})})},scrollTop:function(){if(!this.length)return;return"scrollTop"in this[0]?this[0].scrollTop:this[0].scrollY},position:function(){if(!this.length)return;var a=this[0],b=this.offsetParent(),d=this.offset(),e=o.test(b[0].nodeName)?{top:0,left:0}:b.offset();return d.top-=parseFloat(c(a).css("margin-top"))||0,d.left-=parseFloat(c(a).css("margin-left"))||0,e.top+=parseFloat(c(b[0]).css("border-top-width"))||0,e.left+=parseFloat(c(b[0]).css("border-left-width"))||0,{top:d.top-e.top,left:d.left-e.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||h.body;while(a&&!o.test(a.nodeName)&&c(a).css("position")
=="static")a=a.offsetParent;return a})}},c.fn.detach=c.fn.remove,["width","height"].forEach(function(b){c.fn[b]=function(d){var e,f=this[0],g=b.replace(/./,function(a){return a[0].toUpperCase()});return d===a?G(f)?f["inner"+g]:H(f)?f.documentElement["offset"+g]:(e=this.offset())&&e[b]:this.each(function(a){f=c(this),f.css(b,V(this,d,a,f[b]()))})}}),q.forEach(function(a,b){var d=b%2;c.fn[a]=function(){var a,e=c.map(arguments,function(b){return a=E(b),a=="object"||a=="array"||b==null?b:A.fragment(b)}),f,g=this.length>1;return e.length<1?this:this.each(function(a,h){f=d?h:h.parentNode,h=b==0?h.nextSibling:b==1?h.firstChild:b==2?h:null,e.forEach(function(a){if(g)a=a.cloneNode(!0);else if(!f)return c(a).remove();Z(f.insertBefore(a,h),function(a){a.nodeName!=null&&a.nodeName.toUpperCase()==="SCRIPT"&&(!a.type||a.type==="text/javascript")&&!a.src&&window.eval.call(window,a.innerHTML)})})})},c.fn[d?a+"To":"insert"+(b?"Before":"After")]=function(b){return c(b)[a](this),this}}),A.Z.prototype=c.fn,A.uniq=C,A.deserializeValue=Y,c.zepto=A,c}();window.Zepto=Zepto,"$"in window||(window.$=Zepto),function(a){function b(a){var b=this.os={},c=this.browser={},d=a.match(/WebKit\/([\d.]+)/),e=a.match(/(Android)\s+([\d.]+)/),f=a.match(/(iPad).*OS\s([\d_]+)/),g=!f&&a.match(/(iPhone\sOS)\s([\d_]+)/),h=a.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),i=h&&a.match(/TouchPad/),j=a.match(/Kindle\/([\d.]+)/),k=a.match(/Silk\/([\d._]+)/),l=a.match(/(BlackBerry).*Version\/([\d.]+)/),m=a.match(/(BB10).*Version\/([\d.]+)/),n=a.match(/(RIM\sTablet\sOS)\s([\d.]+)/),o=a.match(/PlayBook/),p=a.match(/Chrome\/([\d.]+)/)||a.match(/CriOS\/([\d.]+)/),q=a.match(/Firefox\/([\d.]+)/);if(c.webkit=!!d)c.version=d[1];e&&(b.android=!0,b.version=e[2]),g&&(b.ios=b.iphone=!0,b.version=g[2].replace(/_/g,".")),f&&(b.ios=b.ipad=!0,b.version=f[2].replace(/_/g,".")),h&&(b.webos=!0,b.version=h[2]),i&&(b.touchpad=!0),l&&(b.blackberry=!0,b.version=l[2]),m&&(b.bb10=!0,b.version=m[2]),n&&(b.rimtabletos=!0,b.version=n[2]),o&&(c.playbook=!0),j&&(b.kindle=!0,b.version=j[1]),k&&(c.silk=!0,c.version=k[1]),!k&&b.android&&a.match(/Kindle Fire/)&&(c.silk=!0),p&&(c.chrome=!0,c.version=p[1]),q&&(c.firefox=!0,c.version=q[1]),b.tablet=!!(f||o||e&&!a.match(/Mobile/)||q&&a.match(/Tablet/)),b.phone=!b.tablet&&!!(e||g||h||l||m||p&&a.match(/Android/)||p&&a.match(/CriOS\/([\d.]+)/)||q&&a.match(/Mobile/))}b.call(a,navigator.userAgent),a.__detect=b}(Zepto),function(a){function g(a){return a._zid||(a._zid=d++)}function h(a,b,d,e){b=i(b);if(b.ns)var f=j(b.ns);return(c[g(a)]||[]).filter(function(a){return a&&(!b.e||a.e==b.e)&&(!b.ns||f.test(a.ns))&&(!d||g(a.fn)===g(d))&&(!e||a.sel==e)})}function i(a){var b=(""+a).split(".");return{e:b[0],ns:b.slice(1).sort().join(" ")}}function j(a){return new RegExp("(?:^| )"+a.replace(" "," .* ?")+"(?: |$)")}function k(b,c,d){a.type(b)!="string"?a.each(b,d):b.split(/\s/).forEach(function(a){d(a,c)})}function l(a,b){return a.del&&(a.e=="focus"||a.e=="blur")||!!b}function m(a){return f[a]||a}function n(b,d,e,h,j,n){var o=g(b),p=c[o]||(c[o]=[]);k(d,e,function(c,d){var e=i(c);e.fn=d,e.sel=h,e.e in f&&(d=function(b){var c=b.relatedTarget;if(!c||c!==this&&!a.contains(this,c))return e.fn.apply(this,arguments)}),e.del=j&&j(d,c);var g=e.del||d;e.proxy=function(a){var c=g.apply(b,[a].concat(a.data));return c===!1&&(a.preventDefault(),a.stopPropagation()),c},e.i=p.length,p.push(e),b.addEventListener(m(e.e),e.proxy,l(e,n))})}function o(a,b,d,e,f){var i=g(a);k(b||"",d,function(b,d){h(a,b,d,e).forEach(function(b){delete c[i][b.i],a.removeEventListener(m(b.e),b.proxy,l(b,f))})})}function t(b){var c,d={originalEvent:b};for(c in b)!r.test(c)&&b[c]!==undefined&&(d[c]=b[c]);return a.each(s,function(a,c){d[a]=function(){return this[c]=p,b[a].apply(b,arguments)},d[c]=q}),d}function u(a){if(!("defaultPrevented"in a)){a.defaultPrevented=!1;var b=a.preventDefault;a.preventDefault=function(){this.defaultPrevented=!0,b.call(this)}}}var b=a.zepto.qsa,c={},d=1,e={},f={mouseenter:"mouseover",mouseleave:"mouseout"};e.click=e.mousedown=e.mouseup=e.mousemove="MouseEvents",a.event={add:n,remove:o},a.
proxy=function(b,c){if(a.isFunction(b)){var d=function(){return b.apply(c,arguments)};return d._zid=g(b),d}if(typeof c=="string")return a.proxy(b[c],b);throw new TypeError("expected function")},a.fn.bind=function(a,b){return this.each(function(){n(this,a,b)})},a.fn.unbind=function(a,b){return this.each(function(){o(this,a,b)})},a.fn.one=function(a,b){return this.each(function(c,d){n(this,a,b,null,function(a,b){return function(){var c=a.apply(d,arguments);return o(d,b,a),c}})})};var p=function(){return!0},q=function(){return!1},r=/^([A-Z]|layer[XY]$)/,s={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};a.fn.delegate=function(b,c,d){return this.each(function(e,f){n(f,c,d,b,function(c){return function(d){var e,g=a(d.target).closest(b,f).get(0);if(g)return e=a.extend(t(d),{currentTarget:g,liveFired:f}),c.apply(g,[e].concat([].slice.call(arguments,1)))}})})},a.fn.undelegate=function(a,b,c){return this.each(function(){o(this,b,c,a)})},a.fn.live=function(b,c){return a(document.body).delegate(this.selector,b,c),this},a.fn.die=function(b,c){return a(document.body).undelegate(this.selector,b,c),this},a.fn.on=function(b,c,d){return!c||a.isFunction(c)?this.bind(b,c||d):this.delegate(c,b,d)},a.fn.off=function(b,c,d){return!c||a.isFunction(c)?this.unbind(b,c||d):this.undelegate(c,b,d)},a.fn.trigger=function(b,c){if(typeof b=="string"||a.isPlainObject(b))b=a.Event(b);return u(b),b.data=c,this.each(function(){"dispatchEvent"in this&&this.dispatchEvent(b)})},a.fn.triggerHandler=function(b,c){var d,e;return this.each(function(f,g){d=t(typeof b=="string"?a.Event(b):b),d.data=c,d.target=g,a.each(h(g,b.type||b),function(a,b){e=b.proxy(d);if(d.isImmediatePropagationStopped())return!1})}),e},"focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select keydown keypress keyup error".split(" ").forEach(function(b){a.fn[b]=function(a){return a?this.bind(b,a):this.trigger(b)}}),["focus","blur"].forEach(function(b){a.fn[b]=function(a){return a?this.bind(b,a):this.each(function(){try{this[b]()}catch(a){}}),this}}),a.Event=function(a,b){typeof a!="string"&&(b=a,a=b.type);var c=document.createEvent(e[a]||"Events"),d=!0;if(b)for(var f in b)f=="bubbles"?d=!!b[f]:c[f]=b[f];return c.initEvent(a,d,!0,null,null,null,null,null,null,null,null,null,null,null,null),c.isDefaultPrevented=function(){return this.defaultPrevented},c}}(Zepto),function($){function triggerAndReturn(a,b,c){var d=$.Event(b);return $(a).trigger(d,c),!d.defaultPrevented}function triggerGlobal(a,b,c,d){if(a.global)return triggerAndReturn(b||document,c,d)}function ajaxStart(a){a.global&&$.active++===0&&triggerGlobal(a,null,"ajaxStart")}function ajaxStop(a){a.global&&!--$.active&&triggerGlobal(a,null,"ajaxStop")}function ajaxBeforeSend(a,b){var c=b.context;if(b.beforeSend.call(c,a,b)===!1||triggerGlobal(b,c,"ajaxBeforeSend",[a,b])===!1)return!1;triggerGlobal(b,c,"ajaxSend",[a,b])}function ajaxSuccess(a,b,c){var d=c.context,e="success";c.success.call(d,a,e,b),triggerGlobal(c,d,"ajaxSuccess",[b,c,a]),ajaxComplete(e,b,c)}function ajaxError(a,b,c,d){var e=d.context;d.error.call(e,c,b,a),triggerGlobal(d,e,"ajaxError",[c,d,a]),ajaxComplete(b,c,d)}function ajaxComplete(a,b,c){var d=c.context;c.complete.call(d,b,a),triggerGlobal(c,d,"ajaxComplete",[b,c]),ajaxStop(c)}function empty(){}function mimeToDataType(a){return a&&(a=a.split(";",2)[0]),a&&(a==htmlType?"html":a==jsonType?"json":scriptTypeRE.test(a)?"script":xmlTypeRE.test(a)&&"xml")||"text"}function appendQuery(a,b){return(a+"&"+b).replace(/[&?]{1,2}/,"?")}function serializeData(a){a.processData&&a.data&&$.type(a.data)!="string"&&(a.data=$.param(a.data,a.traditional)),a.data&&(!a.type||a.type.toUpperCase()=="GET")&&(a.url=appendQuery(a.url,a.data))}function parseArguments(a,b,c,d){var e=!$.isFunction(b);return{url:a,data:e?b:undefined,success:e?$.isFunction(c)?c:undefined:b,dataType:e?d||c:c}}function serialize(a,b,c,d){var e,f=$.isArray(b);$.each(b,function(b,g){e=$.type(g),d&&(b=c?
d:d+"["+(f?"":b)+"]"),!d&&f?a.add(g.name,g.value):e=="array"||!c&&e=="object"?serialize(a,g,c,b):a.add(b,g)})}var jsonpID=0,document=window.document,key,name,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,scriptTypeRE=/^(?:text|application)\/javascript/i,xmlTypeRE=/^(?:text|application)\/xml/i,jsonType="application/json",htmlType="text/html",blankRE=/^\s*$/;$.active=0,$.ajaxJSONP=function(a){if("type"in a){var b="jsonp"+ ++jsonpID,c=document.createElement("script"),d=function(){clearTimeout(g),$(c).remove(),delete window[b]},e=function(c){d();if(!c||c=="timeout")window[b]=empty;ajaxError(null,c||"abort",f,a)},f={abort:e},g;return ajaxBeforeSend(f,a)===!1?(e("abort"),!1):(window[b]=function(b){d(),ajaxSuccess(b,f,a)},c.onerror=function(){e("error")},c.src=a.url.replace(/=\?/,"="+b),$("head").append(c),a.timeout>0&&(g=setTimeout(function(){e("timeout")},a.timeout)),f)}return $.ajax(a)},$.ajaxSettings={type:"GET",beforeSend:empty,success:empty,error:empty,complete:empty,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript",json:jsonType,xml:"application/xml, text/xml",html:htmlType,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0},$.ajax=function(options){var settings=$.extend({},options||{});for(key in $.ajaxSettings)settings[key]===undefined&&(settings[key]=$.ajaxSettings[key]);ajaxStart(settings),settings.crossDomain||(settings.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(settings.url)&&RegExp.$2!=window.location.host),settings.url||(settings.url=window.location.toString()),serializeData(settings),settings.cache===!1&&(settings.url=appendQuery(settings.url,"_="+Date.now()));var dataType=settings.dataType,hasPlaceholder=/=\?/.test(settings.url);if(dataType=="jsonp"||hasPlaceholder)return hasPlaceholder||(settings.url=appendQuery(settings.url,"callback=?")),$.ajaxJSONP(settings);var mime=settings.accepts[dataType],baseHeaders={},protocol=/^([\w-]+:)\/\//.test(settings.url)?RegExp.$1:window.location.protocol,xhr=settings.xhr(),abortTimeout;settings.crossDomain||(baseHeaders["X-Requested-With"]="XMLHttpRequest"),mime&&(baseHeaders.Accept=mime,mime.indexOf(",")>-1&&(mime=mime.split(",",2)[0]),xhr.overrideMimeType&&xhr.overrideMimeType(mime));if(settings.contentType||settings.contentType!==!1&&settings.data&&settings.type.toUpperCase()!="GET")baseHeaders["Content-Type"]=settings.contentType||"application/x-www-form-urlencoded";settings.headers=$.extend(baseHeaders,settings.headers||{}),xhr.onreadystatechange=function(){if(xhr.readyState==4){xhr.onreadystatechange=empty,clearTimeout(abortTimeout);var result,error=!1;if(xhr.status>=200&&xhr.status<300||xhr.status==304||xhr.status==0&&protocol=="file:"){dataType=dataType||mimeToDataType(xhr.getResponseHeader("content-type")),result=xhr.responseText;try{dataType=="script"?(1,eval)(result):dataType=="xml"?result=xhr.responseXML:dataType=="json"&&(result=blankRE.test(result)?null:$.parseJSON(result))}catch(e){error=e}error?ajaxError(error,"parsererror",xhr,settings):ajaxSuccess(result,xhr,settings)}else ajaxError(null,xhr.status?"error":"abort",xhr,settings)}};var async="async"in settings?settings.async:!0;xhr.open(settings.type,settings.url,async);for(name in settings.headers)xhr.setRequestHeader(name,settings.headers[name]);return ajaxBeforeSend(xhr,settings)===!1?(xhr.abort(),!1):(settings.timeout>0&&(abortTimeout=setTimeout(function(){xhr.onreadystatechange=empty,xhr.abort(),ajaxError(null,"timeout",xhr,settings)},settings.timeout)),xhr.send(settings.data?settings.data:null),xhr)},$.get=function(a,b,c,d){return $.ajax(parseArguments.apply(null,arguments))},$.post=function(a,b,c,d){var e=parseArguments.apply(null,arguments);return e.type="POST",$.ajax(e)},$.getJSON=function(a,b,c){var d=parseArguments.apply(null,arguments);return d.dataType="json",$.ajax(d)},$.fn.load=function(a,b,c){if(!this.length)return this;var d=this,e=a.split(/\s/),f,g=parseArguments(a,b,c),h=g.success;return e.length>1&&(g.url=e[0],f=e[1]),g.success=function(a){d.html(f?$("<div>").html(a.replace(
rscript,"")).find(f):a),h&&h.apply(d,arguments)},$.ajax(g),this};var escape=encodeURIComponent;$.param=function(a,b){var c=[];return c.add=function(a,b){this.push(escape(a)+"="+escape(b))},serialize(c,a,b),c.join("&").replace(/%20/g,"+")}}(Zepto),function(a){a.fn.serializeArray=function(){var b=[],c;return a(Array.prototype.slice.call(this.get(0).elements)).each(function(){c=a(this);var d=c.attr("type");this.nodeName.toLowerCase()!="fieldset"&&!this.disabled&&d!="submit"&&d!="reset"&&d!="button"&&(d!="radio"&&d!="checkbox"||this.checked)&&b.push({name:c.attr("name"),value:c.val()})}),b},a.fn.serialize=function(){var a=[];return this.serializeArray().forEach(function(b){a.push(encodeURIComponent(b.name)+"="+encodeURIComponent(b.value))}),a.join("&")},a.fn.submit=function(b){if(b)this.bind("submit",b);else if(this.length){var c=a.Event("submit");this.eq(0).trigger(c),c.defaultPrevented||this.get(0).submit()}return this}}(Zepto),function(a,b){function s(a){return t(a.replace(/([a-z])([A-Z])/,"$1-$2"))}function t(a){return a.toLowerCase()}function u(a){return d?d+a:t(a)}var c="",d,e,f,g={Webkit:"webkit",Moz:"",O:"o",ms:"MS"},h=window.document,i=h.createElement("div"),j=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,k,l,m,n,o,p,q,r={};a.each(g,function(a,e){if(i.style[a+"TransitionProperty"]!==b)return c="-"+t(a)+"-",d=e,!1}),k=c+"transform",r[l=c+"transition-property"]=r[m=c+"transition-duration"]=r[n=c+"transition-timing-function"]=r[o=c+"animation-name"]=r[p=c+"animation-duration"]=r[q=c+"animation-timing-function"]="",a.fx={off:d===b&&i.style.transitionProperty===b,speeds:{_default:400,fast:200,slow:600},cssPrefix:c,transitionEnd:u("TransitionEnd"),animationEnd:u("AnimationEnd")},a.fn.animate=function(b,c,d,e){return a.isPlainObject(c)&&(d=c.easing,e=c.complete,c=c.duration),c&&(c=(typeof c=="number"?c:a.fx.speeds[c]||a.fx.speeds._default)/1e3),this.anim(b,c,d,e)},a.fn.anim=function(c,d,e,f){var g,h={},i,t="",u=this,v,w=a.fx.transitionEnd;d===b&&(d=.4),a.fx.off&&(d=0);if(typeof c=="string")h[o]=c,h[p]=d+"s",h[q]=e||"linear",w=a.fx.animationEnd;else{i=[];for(g in c)j.test(g)?t+=g+"("+c[g]+") ":(h[g]=c[g],i.push(s(g)));t&&(h[k]=t,i.push(k)),d>0&&typeof c=="object"&&(h[l]=i.join(", "),h[m]=d+"s",h[n]=e||"linear")}return v=function(b){if(typeof b!="undefined"){if(b.target!==b.currentTarget)return;a(b.target).unbind(w,v)}a(this).css(r),f&&f.call(this)},d>0&&this.bind(w,v),this.size()&&this.get(0).clientLeft,this.css(h),d<=0&&setTimeout(function(){u.each(function(){v.call(this)})},0),this},i=null}(Zepto)

		var styles = {
			avenirwhite: "http://jasonm23.github.io/markdown-css-themes/avenir-white.css",
			foghorn: "http://jasonm23.github.io/markdown-css-themes/foghorn.css",
			markdown10: "http://jasonm23.github.io/markdown-css-themes/markdown10.css",
			markdown1: "http://jasonm23.github.io/markdown-css-themes/markdown1.css",
			markdown2: "http://jasonm23.github.io/markdown-css-themes/markdown2.css",
			markdown3: "http://jasonm23.github.io/markdown-css-themes/markdown3.css",
			markdown4: "http://jasonm23.github.io/markdown-css-themes/markdown4.css",
			markdown5: "http://jasonm23.github.io/markdown-css-themes/markdown5.css",
			markdown6: "http://jasonm23.github.io/markdown-css-themes/markdown6.css",
			markdown7: "http://jasonm23.github.io/markdown-css-themes/markdown7.css",
			markdown8: "http://jasonm23.github.io/markdown-css-themes/markdown8.css",
			markdown9: "http://jasonm23.github.io/markdown-css-themes/markdown9.css",
			markdownalt: "http://jasonm23.github.io/markdown-css-themes/markdown-alt.css",
			markdown: "http://jasonm23.github.io/markdown-css-themes/markdown.css",
			screen: "http://jasonm23.github.io/markdown-css-themes/screen.css",
			swiss: "http://jasonm23.github.io/markdown-css-themes/swiss.css",
			/*GitHub: "https://gist.github.com/robsimmons/1175938/raw/4cf6e61c7fb5d766861f30e98640665f464a35af/gh-like.css",
			GitHub2: "https://raw.github.com/borismus/markdown-preview/master/markdown.css",*/
			Space: "http://kevinburke.bitbucket.org/markdowncss/markdown.css"
		}

		//Default style
		$style = $("#style").attr("href", styles.markdown9);

		Zepto(function($){
			$.each(styles, function(key, value){
				$("#styles").append($("<a>", {
				"href": value,
				"html": key
				}));
			});
			$("#styles a").click(function (e){
				e.preventDefault();
				$style.attr("href", $(this).attr("href"));
			});
		});
	</script>
</head>
<body>
	<div id="styles">Style:</div>
<h1>Laravel 4 <small>by @Stolz</small></h1>

<p><a id="index"></a></p>

<h2>Índice</h2>

<ol>
<li><a href="#install">Instalación</a>.</li>
<li><a href="#disk_structure">Estructura en disco</a>.</li>
<li><a href="#config">Configuración</a>.
<ul>
<li><a href="#constants">Constantes</a>.</li>
<li><a href="#environment_config">Entornos</a>.</li>
</ul></li>
<li><a href="#routes">Rutas</a>.
<ul>
<li><a href="#basic_route">Rutas básicas</a>.</li>
<li><a href="#advanced_route">Rutas avanzadas</a>.</li>
<li><a href="#route_params">Rutas con parámetros</a>.</li>
<li><a href="#route_names">Rutas con nombre</a>.</li>
<li><a href="#route_filters">Filtros de rutas</a>.</li>
<li><a href="#route_groups">Grupos de rutas</a>.
<ul>
<li><a href="#route_subdomain">Subdominios</a>.</li>
<li><a href="#route_prefix">Prefijos</a>.</li>
</ul></li>
<li><a href="#route_bind">Injección de modelos</a>.</li>
</ul></li>
<li><a href="#responses">Respuestas</a>.
<ul>
<li><a href="#views">Vistas</a>.
<ul>
<li><a href="#view_composers">Compositores</a>.</li>
<li><a href="#blade">Blade</a>.</li>
</ul></li>
<li><a href="#redirect">Redirecciones</a>.</li>
</ul></li>
<li><a href="#controllers">Controladores</a>.
<ul>
<li><a href="#RESTful_controllers">Controladores RESTful</a>.</li>
<li><a href="#resource_controllers">Controladores RESTful de recurso</a>.</li>
</ul></li>
<li><a href="#user_input">Datos de usuario</a>.</li>
<li><a href="#migrations">Migraciones</a>.</li>
<li><a href="#seeders">Sembradores</a>.</li>
<li><a href="#models">Modelos y Eloquent ORM</a>.
<ul>
<li><a href="#model_attributes">Atributos</a>.</li>
<li><a href="#model_retrieve">Obtener</a>.</li>
<li><a href="#model_aggregate">Funciones de agregación</a>.</li>
<li><a href="#model_store">Guardar</a>.</li>
<li><a href="#model_update">Actualizar</a>.</li>
<li><a href="#model_delete">Borrar</a>.</li>
<li><a href="#model_softdel">SoftDelete</a>.</li>
<li><a href="#model_scope">Consultas con nombre</a>.</li>
<li><a href="#transactions">Transacciones</a>.</li>
<li><a href="#model_relationships">Definir relaciones</a> (<a href="#rel1-1">1-1</a>, <a href="#rel1-n">1-n</a>, <a href="#reln-m">n-m</a>).</li>
<li><a href="#model_eager">Incluir relacionados en los resultados</a>.</li>
<li><a href="#model_relate">Relacionar modelos</a>.</li>
</ul></li>
<li><a href="#packages">Crear paquetes</a>.</li>
<li><a href="#artisan">Artisan</a>
<ul>
<li><a href="#generators">Generadores de código</a>.
<ul>
<li><a href="#generators_migrations">Migraciones</a>.</li>
<li><a href="#generators_models">Modelos</a>.</li>
<li><a href="#generators_controllers">Controladores</a>.</li>
<li><a href="#generators_views">Vistas</a>.</li>
<li><a href="#generators_forms">Formularios</a>.</li>
<li><a href="#generators_seeds">Sembradores</a>.</li>
</ul></li>
</ul></li>
</ol>

<p><a id="install"></a></p>

<h2>Instalación</h2>

<p>Instalar <a href="http://getcomposer.org/">Composer</a> (gestor de dependencias usado por Laravel)</p>

<pre><code>sudo su
curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin/
</code></pre>

<p>Crear alias para dos comandos que usaremos frecuentemente en Laravel</p>

<pre><code>alias composer='/usr/local/bin/composer.phar --ansi'
alias artisan='php artisan --ansi'
</code></pre>

<p>Instalar Framework</p>

<pre><code>git clone git@github.com:Stolz/laravel.git myProject &amp;&amp; cd myProject
git remote add upstream git://github.com/laravel/laravel.git
</code></pre>

<p>Instalar dependencias y generar clave aleatoria</p>

<pre><code>composer install
artisan key:generate
</code></pre>

<p>Actualizar framework</p>

<pre><code>git pull upstream master
</code></pre>

<p>Actualizar dependencias (y regenerar composer.lock)</p>

<pre><code>composer update
</code></pre>

<p>Actualizar la lista de clases auto-cargables</p>

<pre><code>composer dump-autoload
</code></pre>

<p><a href="#index">Volver al índice</a></p>

<p><a id="disk_structure"></a></p>

<h2>Estructura en disco</h2>

<p>Explicación breve de los archivos y directorios:</p>

<ul>
<li><strong>/app</strong> <em>Contiene todo el código de nuestra aplicación.</em>
<ul>
<li><strong>/commands</strong> <em>Para añadir comandos personales a <a href="#artisan">Artisan</a>.</em></li>
<li><strong>/config</strong> <em>Archivos de <a href="#config">configuración</a> de los <a href="#environment_config">entornos</a>.</em></li>
<li><strong>/controllers</strong> <em>Contiene los <a href="#controllers">controladores</a>.</em></li>
<li><strong>/database</strong> <em>Contiene los archivos para crear la base de datos (<a href="#migrations">migraciones</a>) e inicilizarla con datos (<a href="#seeders">sembradores</a>).</em></li>
<li><strong>/lang</strong> <em>Contiene traducciones.</em></li>
<li><strong>/models</strong> <em>Contiene los <a href="#models">modelos</a>.</em></li>
<li><strong>/start</strong> <em>Contiene archivos relacionados con la inicialización de nuestra aplicación.</em></li>
<li><strong>/storage</strong> <em>Usado por Laravel para guardar (escribir) datos.</em></li>
<li><strong>/tests</strong> <em>Contiene los tests unitarios de nuestra aplicación.</em></li>
<li><strong>/views</strong> <em>Contiene las <a href="#views">vistas</a>.</em></li>
<li>filters.php <em>Define los <a href="#route_filters">filtros de rutas</a>.</em></li>
<li>routes.php <em>Define las <a href="#routes">rutas</a>.</em> <br/><br/></li>
</ul></li>
<li><strong>/bootstrap</strong> <em>Contiene archivos relacionados con la inicialización del framework.</em>
<ul>
<li>autoload.php <em>Inicializador principal. Entre otros carga el auto-cargador de clases de Composer y el del propio Laravel.</em></li>
<li>paths.php <em>Define las rutas dónde Laravel debe buscar (<code>app</code>, <code>public</code> , <code>storage</code>, ...).</em></li>
<li>start.php <em>Inicializa <code>$app</code> y detecta el <a href="#environment_config">entorno</a>.</em> <br/><br/></li>
</ul></li>
<li><strong>/public</strong> <em>Es el webroot (parte accesible desde web) de nuestra aplicación. Sirve para almacenar nuestros assets y el front controller.</em>
<ul>
<li><strong>/packages</strong> <em>Sirve para almacenar assets de aplicaciones de terceros.</em></li>
<li>index.php <em>Front controller de nuestra aplicación.</em> <br/><br/></li>
</ul></li>
<li><strong>/vendor</strong> <em>Contiene todos los paquetes instalados con Composer.</em> <br/><br/></li>
<li>artisan <em>Ejecutable para interactuar por <a href="#artisan">línea de comandos</a> con Laravel.</em></li>
<li>composer.json <em>Configuración de los paquetes Composer que usa este proyecto.</em></li>
<li>composer.lock <em>Si está presente composer siempre instala esta versiones de los paquetes, independientemente de lo que ponga en composer.json.</em></li>
<li>.gitignore <em>Indica las rutas que no están bajo el control de versiones de Git.</em></li>
<li>phpunit.xml <em>Configuración de los test unitarios de Laravel.</em></li>
<li>server.php <em>Sirve para emular mod_rewrite desde el servidor web incluido de serie en PHP.</em></li>
</ul>

<p><a href="#index">Volver al índice</a></p>

<p><a id="config"></a></p>

<h2>Configuración</h2>

<p>Toda la configuración se guarda en el directorio <code>app/config/</code>.</p>

<p>Para leer un valor de configuración en tiempo de ejecución (formato: <em>archivo.clave</em>)</p>

<pre><code>Config::get('app.timezone');
</code></pre>

<p>Leer y si la clave solicitada no existe usar un valor de fallback</p>

<pre><code>Config::get('app.timezone', 'UTC');
</code></pre>

<p>Cambiar configuración al vuelo</p>

<pre><code>Config::set('database.default', 'sqlite');
</code></pre>

<p>Comprobar si se ha indicado una configuración</p>

<pre><code>Config::has('archivo.clave');
</code></pre>

<p><a id="constants"></a></p>

<h3>Constantes</h3>

<p>Laravel no tiene un sitio dedicado para establecer las constantes por lo que debe escogerse uno dependiendo de las necesiadades o gustos personales. El orden en el que se cargan los archivos es (más o menos, ya que depende de la configuración actual):</p>

<ol>
<li>public/index.php</li>
<li>bootstrap/autoload.php</li>
<li>bootstrap/start.php</li>
<li>bootstrap/paths.php</li>
<li>app/config/*.php</li>
<li>app/config/ENTORNO_ACTUAL/*.php</li>
<li>app/start/global.php</li>
<li>app/filters.php</li>
<li>app/start/ENTORNO_ACTUAL.php</li>
<li>app/routes.php</li>
<li>código enrutado como controladores y vistas</li>
</ol>

<p>Por ejemplo, si necesitamos que nuestras constantes sean accesibles para toda nuestra aplicación incluyendo librerías y archivos de configuración podemos usar <code>public/index.php</code>. Si por ejemplo solo las necesitamos una vez leida la configuración podemos definirlas en <code>app/start/global.php</code>.</p>

<p><a id="environment_config"></a></p>

<h3>Entornos</h3>

<p>Por defecto existen dos entornos ya creados y cuyos nombres quedan reservados:</p>

<ul>
<li><code>production</code>: Entorno de produccción.</li>
<li><code>testing</code>: Entorno para pruebas unitarias.</li>
</ul>

<p>El entorno por defecto es siempre <code>production</code> y sus archivos de configuración se encuentran en <code>app/config/</code>. Para configurar un nuevo entorno crear en <code>app/config/</code> un subdirectorio con el nombre deseado para el entorno y copiar en él los archivos cuya configuración queramos cambiar. Dichos ficheros no tienen por qué tener definidas todas la opciones de configuración sino solo aquellas que queramos cambiar.</p>

<p>El entorno actual se determina automáticamente en la llamada <code>$app-&gt;detectEnvironment()</code> del archivo <code>bootstrap/start.php</code>. Para definir los entornos podemos usar un array o una <em>closure</em>.</p>

<p>Ejemplos:</p>

<pre><code>//Con array
$env = $app-&gt;detectEnvironment(array(
    'local' =&gt; array('localhost', '127.0.0.1'),
    'staging' =&gt; array('stage1.example.com', 'stage2.example.com')
));

//Con closure
$env = $app-&gt;detectEnvironment(function()
{
    return $_SERVER['SERVER_NAME'];
});
</code></pre>

<p>Para conocer el entorno actual desde en nuestro código ...</p>

<pre><code>$environment = App::environment();
</code></pre>

<p>...o desde línea de comandos</p>

<pre><code>artisan env
</code></pre>

<p><a href="#index">Volver al índice</a></p>

<p><a id="routes"></a></p>

<h2>Rutas</h2>

<p>Las rutas indican qué ejecutar en función de la URL solicitada. <strong>Todas las rutas</strong> (URLs) a las que queremos que nuestra aplicación responda <strong>deben declararse explícitamente</strong> en el archivo <code>app/routes.php</code>.</p>

<p>En Laravel todo el código enrutado (rutas, <a href="#controllers">controladores</a>, ...) debe devolver SIEMPRE un objeto del tipo <a href="#responses">Response</a> pero, por simplicidad, en los siguientes ejemplos se va a usar intencionadamente como respuesta un simple <code>string</code>.</p>

<ul>
<li><a href="#basic_route">Rutas básicas</a>.</li>
<li><a href="#advanced_route">Rutas avanzadas</a>.</li>
<li><a href="#route_params">Rutas con parámetros</a>.</li>
<li><a href="#route_names">Rutas con nombre</a>.</li>
<li><a href="#route_filters">Filtros de rutas</a>.</li>
<li><a href="#route_groups">Grupos de rutas</a>.
<ul>
<li><a href="#route_subdomain">Subdominios</a>.</li>
<li><a href="#route_prefix">Prefijos</a>.</li>
</ul></li>
<li><a href="#route_bind">Injección de modelos</a>.</li>
</ul>

<p><a id="basic_route"></a></p>

<h3>Rutas básicas</h3>

<p>La ruta básica constiste en un verbo HTTP + URL + función anónima de PHP o <em>closure</em>.</p>

<pre><code>Route::verbo($url, function () {return 'Hello';});
</code></pre>

<p>Ejemplos de rutas básicas:</p>

<p><em>Rutas que responde respectivamente a peticiones GET, POST, PUT y DELETE</em></p>

<pre><code>Route::get('/', function() {
    return 'Hello';
});

Route::post('foo/bar', function() {
    return 'Hello';
});

Route::put('foo/bar', function() {
    return 'Hello';
});

Route::delete('foo/bar', function() {
    return 'Hello';
});
</code></pre>

<p><em>Ruta que responde a todos los verbos HTTP</em></p>

<pre><code>Route::any('foo/bar', function() {
    return 'Hello';
});
</code></pre>

<p>Podemos ver un resumen de todas las rutas defininas con el comando</p>

<pre><code>artisan routes
</code></pre>

<p><a id="advanced_route"></a></p>

<h3>Rutas avanzadas</h3>

<p>Se pueden definir rutas avanzadas jugando con el segundo parámetro de la ruta. Existen numerosos tipos de rutas avanzadas que usan el segundo parámetro de distintas formas.</p>

<p>Una forma de ruta avanzada es hacer que el segundo parámetro de la ruta sea un array con pares <code>'clave'=&gt; $valor</code> junto a una <em>closure</em>. Si la clave es <code>before</code> o <code>after</code> sirve para <a href="#route_filters">asignar un filtro a la ruta</a>. La clave <code>as</code> sirve para <a href="#route_names">asignar un nombre a la ruta</a>. La clave <code>uses</code> sirve para hacer que la ruta <a href="#route_to_controller">ejecute un método</a> de un <a href="#controllers">controlador</a>.</p>

<p>Ejemplos:</p>

<p><a id="route_to_controller"></a><em>Ruta a un controlador</em></p>

<pre><code>//Ambas sintaxis son equivalentes
Route::get('user/profile', 'UserController@showProfile');
Route::get('user/profile', array('uses' =&gt; 'UserController@showProfile'));
</code></pre>

<p><em>Ruta a un <a href="#RESTful_controllers">controlador RESTful</a></em></p>

<pre><code>//El primer parámetro es la base de la url del controlador y el segundo en nombre de la clase del controlador.
Route::controller('users', 'UserController');
</code></pre>

<p><em>Ruta a un <a href="#resource_controllers">controlador de recurso</a></em></p>

<pre><code>Route::resource('photo', 'PhotoController');
Route::resource('photo', 'PhotoController', array('only' =&gt; array('index', 'show')));
Route::resource('photo', 'PhotoController', array('except' =&gt; array('create', 'store', 'update', 'delete')));
</code></pre>

<p><em>Forzar que una ruta responda solo a peticiones HTTPS</em> (<strong>Nota:</strong> Esto no redirecciona a la versión HTTPS, solo da un 404 si no se ha usado HTTPS para acceder a la ruta)</p>

<pre><code>Route::get('safearea', array('https', function() {return 'Must be over HTTPS';}));
</code></pre>

<p><a id="route_params"></a></p>

<h3>Parámetros de rutas</h3>

<p><strong>Nota:</strong> El orden en el que aparecen los parámetros en la ruta y en la <em>closure</em> debe ser el mismo ya que Laravel no interpreta los nombres de los parámetros sino que los asigna en el orden en el que aparecen.</p>

<p>Parámetro obligatorio</p>

<pre><code>//Ruta básica con closure
Route::get('user/{id}', function($id) {
    return 'User '.$id;
});

//Ruta a controlador
Route::get('user/{id}', 'UserController@showProfile');
</code></pre>

<p>Parámetro opcional</p>

<pre><code>Route::get('user/{name?}', function($name = null) {
    return $name;
});
</code></pre>

<p>Parámetro opcional con fallback a valor por defecto</p>

<pre><code>Route::get('user/{name?}', function($name = 'John') {
    return $name;
});
</code></pre>

<p>Parámetro que debe cumplir un expresión regular</p>

<pre><code>Route::get('user/{name}', function($name) {
    return $name; })
-&gt;where('name', '[A-Za-z]+');

Route::get('user/{id}', function($id) {
    return 'User '.$id;
})-&gt;where('id', '[0-9]+');
</code></pre>

<p>Parámetro que debe cumplir un comodín</p>

<pre><code>Route::get('user/(:any)/task/(:num)', function($name, $task) {
    return "$name: $task";
});
</code></pre>

<p>Los comodines pueden ser:</p>

<ul>
<li><code>(:any)</code> Parámetro alfanumérico obligatorio.</li>
<li><code>(:num)</code> Parámetro numéro obligatorio.</li>
<li><code>(:any?)</code> Parámetro opcional.</li>
</ul>

<p>Más de un parámetro</p>

<pre><code>Route::get('user/{id}/{name}', function($id, $name) {
    /*...*/
})-&gt;where(array('id' =&gt; '[0-9]+', 'name' =&gt; '[a-z]+');
</code></pre>

<p><strong>NOTA:</strong> En vez de pasar parámetros para que nuestra lógica obtenga una instancia del <a href="#models">modelo</a> desde la base de datos es posible hacer que sea la propia ruta quien obtenga la instancia directamente y la pase a nuestra lógica usando <a href="#route_bind">route model binding</a>.</p>

<p><a id="route_names"></a></p>

<h3>Rutas con nombre</h3>

<p>Es posible asignar un nombre a una ruta para tener URLs más bonitas en las <a href="#redirect">redirecciones</a> o al generar enlaces.</p>

<pre><code>//Ruta básica con closure
Route::get('user/profile', array('as' =&gt; 'profile', function() {/* ... */}));

//Ruta a controlador
Route::get('user/profile', array('as' =&gt; 'profile', 'uses' =&gt; 'UserController@showProfile'));
</code></pre>

<p>Para usar los nombres definidos</p>

<pre><code>//Al generar enlaces a rutas con nombre
$url = URL::route('profile');

//En las redirecciones
$redirect = Redirect::route('profile');

//Obtener en nombre de la ruta acutal
$name = Route::current()-&gt;getName();
</code></pre>

<p><a id="route_filters"></a></p>

<h3>Filtros de ruta</h3>

<p>Se definen en <code>app/filters.php</code> y sirven para ejecutar reglas o acciones antes o después de servir una ruta. Se usan por ejemplo para requerir autenticación en ciertas areas. El orden de ejecución del filtro respecto a la ruta se establece usando las claves <code>before</code> y <code>after</code> en el array de la ruta avanzada.</p>

<p>Si un filtro devuelve una <a href="#responses">respuesta</a>, dicha respuesta será usada como respuesta de la solicitud y <strong>no se ejecutará la ruta</strong> ni ninguno de los filtros <code>after</code> restantes de la ruta.</p>

<p>De serie vienen ya incluidos algunos filtros especiales:</p>

<ul>
<li><code>before</code> y <code>after</code> <em>se ejecutan SIEMPRE (es decir, no hace falta indicarlos en la clave del array) antes y después de cada petición a nuestra aplicación.</em></li>
<li><code>auth</code> <em>Comprueba que el usuario esté logeado usando la autenticacion nativa de Laravel.</em></li>
<li><code>auth.basic</code> <em>Comprueba que el usuario esté logeado usando autenticación HTTP Basic.</em></li>
<li><code>guest</code> <em>Complementario del filtro auth. Comprueba que el usuario NO esté logeado usando la autenticacion nativa de Laravel.</em></li>
<li><code>csrf</code> <em>Añade proteccion CSRF al envío de formularios para asegurarse de que los datos que recibimos han sido enviados por nuestra propia aplicación.</em></li>
</ul>

<p>Definir un filtro</p>

<pre><code>Route::filter('filtername', function() {

    if ($filter_condition)
    {
        return Redirect::to('foo');
    }

});
</code></pre>

<p>Asignar un filtro a una sola ruta</p>

<pre><code>Route::get('foo/bar', array(
    'before' =&gt; 'filtername',
    function() {
        return 'Hello';
    }
));
</code></pre>

<p>Asignar varios filtros a una sola ruta (el primero que devuelva un <a href="#responses">Response</a> parará el proceso)</p>

<pre><code>Route::get('foo/bar', array(
    'before' =&gt; 'filtername1|filtername2',
    function() {
        return 'Hello';
    }
));

//Sintaxis alternativa
Route::get('foo/bar', array(
    'before' =&gt; array('filtername1','filtername2'),
    function() {
        return 'Hello';
    }
));
</code></pre>

<p>Asignar un filtro <code>before</code> a varias rutas</p>

<pre><code>Route::when('admin/*', 'filtername');
</code></pre>

<p>Asignar un filtro <code>before</code> a varias rutas pero solo para ciertos verbos HTTP</p>

<pre><code>Route::when('admin/*', 'csrf', array('post', 'put'));
</code></pre>

<p>Definir un filtro con parámetros y asignarles valor en la ruta</p>

<pre><code>/* app/filters.php */
Route::filter('filtername', function($route, $request, $custom_param) {
    if ($custom_param &lt; 100)
    {
        return Redirect::to('error');
    }
});

/* app/routes.php */
Route::get('foo/bar', array(
    'before' =&gt; 'filtername:200',
    function() {
        return 'Hello';
    }
));
</code></pre>

<p>Para filtros complejos en vez de usar una <em>Closure</em> se puede indicar que se use una clase implementada por nosotros. Consultar la <a href="http://laravel.com/docs/routing#route-filters">documentación oficial</a> o el libro <a href="http://codebright.daylerees.com/filters">Code Bright</a> para saber cómo hacerlo.</p>

<p><a id="route_groups"></a></p>

<h3>Grupos de rutas</h3>

<p>Sirven para agrupar rutas que requieren usar un mismo filtro sin tener que indicar el filtro en cada ruta.</p>

<pre><code>Route::group(array('before' =&gt; 'auth'), function() {

    Route::get('user/config', function()
    {
        // Esta ruta tiene el filtro Auth
    });

    Route::get('user/profile', function()
    {
        // Esta ruta tiene el filtro Auth
    });

});
</code></pre>

<p><a id="route_subdomain"></a>
Es posible crer un grupo que responda a subdominios...</p>

<pre><code>Route::group(array('domain' =&gt; '{language}.myapp.com'), function() {

    //May be change global lang here ...
    //App::setLocale($language);

    //.. or just pass it to the routes/controllers
    Route::get('user/{id}', function($language, $id) {
        /* ... */
    });

});
</code></pre>

<p><a id="route_prefix"></a>
... o agrupar rutas con un prefijo común para no tener que indicar el prefijo en cada definición de ruta</p>

<pre><code>Route::group(array('prefix' =&gt; 'admin'), function()
{

    Route::get('user', function()
    {
        //Responde a peticiones GET /admin/user
    });

});
</code></pre>

<p>A partir de la versión 4.1 de Laravel se pueden anidar grupos de rutas:</p>

<pre><code>// Area for authenticated users
Route::group(array('https', 'before' =&gt; 'auth'), function() {

    // Change password of current user
    Route::group(array('prefix' =&gt; 'user'), function() {
        Route::get('password', array('as' =&gt; 'user.password', 'uses' =&gt; 'UserPanelController@showChangePasswordForm'));
        Route::put('password', array('as' =&gt; 'user.password.update', 'uses' =&gt; 'UserPanelController@updatePassword'));
    });

    // Admin area
    Route::group(array('prefix' =&gt; 'admin'), function() {
        Route::resource('users', 'UsersController');
        Route::resource('countries', 'CountriesController');
        Route::resource('languages', 'LanguagesController');
    });

});
</code></pre>

<p><a id="route_bind"></a></p>

<h3>Injección de modelos en rutas</h3>

<p>Es posible injectar instancias de <a href="#models">modelos</a> directamente en las rutas. En vez de pasar a la ruta un identificador numérico que debe ser usado por nuestra lógica para recuperar el objeto de la base de datos podemos hacer que la ruta se encargue de ello automáticamente. Esto se conoce como <em>Route Model Binding</em>.</p>

<p>Solo hacen falta dos pasos: 1º asignar un nombre de parámetro a un modelo y 2º hacer un <em>cast</em> del parámetro de la ruta.</p>

<pre><code>Route::model('user', 'User');
Route::get('profile/{user}', function(User $user)
{
    //
});
</code></pre>

<p>En caso de que el objeto no se encuentre se lanza un 404 aunque se puede alterar este comportamiento pasando una <em>closure</em> como tercer parámetro</p>

<pre><code>Route::model('user', 'User', function()
{
    throw new NotFoundException;
});
</code></pre>

<p>Se puede configurar la forma con la que se obtiene el modelo de la base de datos</p>

<pre><code>Route::bind('user', function($value, $route)
{
    return User::where('name', $value)-&gt;first();
});
</code></pre>

<p><a href="#index">Volver al índice</a></p>

<p><a id="responses"></a></p>

<h2>Respuestas</h2>

<p>En Laravel, todo el código enrutado (rutas, <a href="#controllers">controladores</a>, ...) debe devolver SIEMPRE un objeto del tipo <code>Response</code>. En caso de no hacerlo surgirán problemas cuando necesites que Laravel modifique las cabeceras HTTP (por ejemplo al trabajar con <em>cookies</em>).</p>

<p>Laravel incluye varios objetos de tipo respuesta que podemos usar. Los más comunes son las <a href="#views">vistas</a> y las <a href="#redirect">redirecciones</a> pero existen otros por ejemplo para devolver JSON o para que el navegador inicie la descarga de un fichero:</p>

<pre><code>//Devolver una vista con código de error HTTP
return Response::view('error/500', array(), 500);

//Devolver JSON
return Response::json(array('name' =&gt; 'Steve', 'state' =&gt; 'CA'));

//Devolver JSONP
return Response::json(array('name' =&gt; 'Steve', 'state' =&gt; 'CA'))-&gt;setCallback(Input::get('callback'));

//Iniciar la descarga de un fichero (el 2º y 3er parámetros son opcionales)
return Response::download('path/to/remote_name.jpg', 'local_name.jpg', array('header key' =&gt; $header_value));
</code></pre>

<p>También podemos crearnos nuestro propio tipo de respuesta</p>

<pre><code>//Default headers
$response = Response::make("Page not found", 404);
return $response;

//Set custom headers
$response = Response::make("Page not found", 404, array('header key' =&gt; $header_value));
return $response;

//Ser custom headers on the go
$response = Response::make('***some bold text***', 200);
$response-&gt;headers-&gt;set('Content-Type', 'text/x-markdown');
return $response;
</code></pre>

<p>Para más información consulta el <a href="http://laravel.com/api/class-Illuminate.Http.Response.html">API de Response</a> o ya que este componente Laravel es heredado de Symfony puedes leer el <a href="http://api.symfony.com/2.0/Symfony/Component/HttpFoundation/Response.html">API de Symfony</a>.</p>

<p><a id="views"></a></p>

<h3>Vistas</h3>

<p>Las vistas normalmente contienen el HTML de tu aplicación. Se guardan en <code>app/views/</code>. Para hacer referencia a vistas en subdirectorios se usa el punto como separador.</p>

<p>Cargar una vista guardada en <code>app/views/foo/bar.php</code></p>

<pre><code>return View::make('foo.bar');
</code></pre>

<p>Cargar una vista con parámetros</p>

<pre><code>//Todas las sintaxis son equivalentes
return View::make('foo.bar', array('name' =&gt; 'Steve'));
return View::make('foo.bar')-&gt;with('name', 'Steve');
return View::make('foo.bar')-&gt;withName('Steve');
</code></pre>

<p>Añadir variables a todas las vistas</p>

<pre><code>View::share('name', 'Steve');
</code></pre>

<p>Es posible pasar una vista como parámetro de otra vista</p>

<pre><code>View::make('parent.view')-&gt;nest('raw', 'child.view');
View::make('parent.view')-&gt;nest('raw', 'child.view', $data);
</code></pre>

<p><a id="view_composers"></a></p>

<h4>Compositores de vistas</h4>

<p>Es posible hacer que cada vez que se cargue una vista ésta reciba parámetros de forma programada. Esto es útil para evitar repetir código en vistas que siempre reciben los mismos parámetros</p>

<pre><code>View::composer('my.view', function($view)
{
    $view-&gt;with('count', User::count());
});
</code></pre>

<p>Si el primer parámetro es un array el compositor se aplica a varias vistas.</p>

<p><a id="blade"></a></p>

<h4>Blade</h4>

<p><em>Blade</em> es el motor de plantillas integrado en Laravel. Permite crear una jerarquía de vistas y <em>layouts</em> (partes comunes de las vistas). Soporta herencia e injección de subvistas y destaca por su sintaxis muy simple.</p>

<p>Para indicar el <em>layout</em> al que pertenece un vista bien podemos usar la etiqueta <code>@extends()</code> en la propia vista o bien podermos declarar el atributo <code>protected $layout</code> en el controlador de la siguiente manera:</p>

<pre><code>class SomeController extends BaseController {

    protected $layout = 'layouts.master';

    public function index()
    {
        $this-&gt;layout-&gt;content = View::make('foo.bar');
    }
}
</code></pre>

<p>Como se ve, en caso de indicar el <em>layout</em> en el controlador no hace falta que la función devuelva nada con <code>return</code>. En su lugar asignamos <code>$this-&gt;layout-&gt;content</code>. Para indicar una variable del layout:</p>

<pre><code>$this-&gt;layout-&gt;nombrevariable = 'valor';
</code></pre>

<p>Incluir una vista (hereda las variables de la vista actual)</p>

<pre><code>@include('view.file')
</code></pre>

<p>Dibujar una vista (NO hereda las variables de la vista actual)</p>

<pre><code>@render('view.file')
</code></pre>

<p>Definir contenedor (padre) de una sección</p>

<pre><code>@yield('section_name')
</code></pre>

<p>Definir contenedor (padre) de una sección con contenido (en línea) por defecto</p>

<pre><code>@yield('section_name', 'contenido')
</code></pre>

<p>Definir contenedor (padre) de una sección con contenido (en bloque) por defecto</p>

<pre><code>@section('section_name')
contenido
@show
</code></pre>

<p>Definir contenido (hijo) de una sección</p>

<pre><code>@section('section_name')
contenido
@stop
</code></pre>

<p>Definir contenido (hijo) de una sección incluyendo el contenido por defecto del padre</p>

<pre><code>@section('section_name')
@parent
contenido
@stop
</code></pre>

<p>Imprimir una variable</p>

<pre><code>{{ $variable }}
</code></pre>

<p>Imprimir una variable <em>escapando</em> los caracteres especiales a HTML (útil para imprimir datos de usuario)</p>

<pre><code>{{{ $variable }}}
</code></pre>

<p>Para conocer las estructuras de control @if@else, @foreach, ... consulta la <a href="http://laravel.com/docs/templates#other-blade-control-structures">documentación oficial</a>.</p>

<p><a href="#index">Volver al índice</a></p>

<p><a id="redirect"></a></p>

<h3>Redirecciones</h3>

<p><code>Redirect</code> es un tipo especial de respuesta que redirige el flujo de la aplicación a otra ruta.</p>

<p>Redirigir a una ruta</p>

<pre><code>return Redirect::to('user/login');
</code></pre>

<p>Redirigir a una ruta incluyendo datos (los datos adjuntas se gaurdan en la sesión y se obtienen con <code>Session::get</code>)</p>

<pre><code>return Redirect::to('user/login')-&gt;with('message', 'Login Failed');
</code></pre>

<p>Redirigir a una ruta con nombre</p>

<pre><code>return Redirect::route('login');
</code></pre>

<p>Redirigir a una ruta con nombre y con parámetros</p>

<pre><code>return Redirect::route('profile', array(1));
</code></pre>

<p>Redirigir a una ruta con nombre y con parámetros con nombre</p>

<pre><code>return Redirect::route('profile', array('user' =&gt; 1));
</code></pre>

<p>Redirigir a la acción de un controlador</p>

<pre><code>return Redirect::action('HomeController@index');
</code></pre>

<p>Redirigir a la acción de un controlador con parámetros</p>

<pre><code>return Redirect::action('UserController@profile', array(1));
</code></pre>

<p>Redirigir a la acción de un controlador con parámetros con nombre</p>

<pre><code>return Redirect::action('UserController@profile', array('user' =&gt; 1));
</code></pre>

<p><a href="#index">Volver al índice</a></p>

<p><a id="controllers"></a></p>

<h2>Controladores</h2>

<p>Los controladores se definen en <code>app/controllers/</code> y sirven para agrupar en una sola clase la lógica de una o varias rutas. El nombre de la clase puede ser cualquier nobre de clase válido en PHP pero se considera buena práctica que acabe en <code>Controller</code>. La clase debe extender <code>BaseController</code>, que también se encuentra en <code>app/controllers/</code> y puede ser modificada para incluir código común a todos los controladores.</p>

<p>Los métodos que queremos que sean <a href="#route_to_controller">accedidos desde las rutas</a> deben ser declarados como públicos.</p>

<pre><code>&lt;?php /* app/controllers/UserController.php */

class UserController extends BaseController
{
    public function showProfile($id)
    {
        $user = User::find($id);

        return View::make('user.profile', array('user' =&gt; $user));
    }

    public function addNew()
    {
        return View::make('bar');
    }

    public function missingMethod($parameters)
    {
        // Método especial "catch-all" que se ejecuta cuando el método indicado no existe en el controlador
    }
}
</code></pre>

<p><a id="RESTful_controllers"></a></p>

<h3>Controladores RESTful</h3>

<p>Usar los verbos HTTP para <a href="#basic_route">rutas básicas</a> con <em>closures</em> es cómodo pero cuando usamos <a href="#route_to_controller">rutas a controladores</a> suele ser más conveniente hacer que el verbo HTTP quede reflejado dentro de la lógica de la aplicación, es decir, en el <a href="#controllers">controlador</a>.</p>

<p>Laravel permite enrutar a un un controlador RESTful usando una sola ruta:</p>

<pre><code>Route::controller('users', 'UserController');
</code></pre>

<p>El primer parámetro es la base de la url del controlador y el segundo en nombre de la clase del controlador.</p>

<p>Para definir un controlador RESTful basta con anteponer el nombre del verbo HTTP en los nombres de los métodos del controlador:</p>

<pre><code>&lt;?php /* app/controllers/UserController.php */

class UserController extends BaseController
{
    public function getIndex()
    {
        // Método especial que responde a la URL base del la ruta, en este caso 'users' ó 'users/'
    }

    public function getProfile($id)
    {
        //Responde a la ruta users/profile/{id} por el método GET
    }

    public function postProfile()
    {
        //Responde a la ruta users/profile por el método POST
    }

    public function postChangePassword()
    {
        //Responde a la ruta users/change-password por el método POST
    }
}
</code></pre>

<p><a id="resource_controllers"></a></p>

<h3>Controladores RESTful de recurso</h3>

<p>Cuando un controlador RESTful se va a encargar de un solo recurso (por ejemplo, fotos, usuarios, noticias) podemos usar <code>artisan</code> para que genere el esqueleto de un controlador RESTful por nosotros.</p>

<pre><code>artisan controller:make PhotoController
</code></pre>

<p>Para registrar una ruta a nuestro controlador de recurso</p>

<pre><code>Route::resource('photo', 'PhotoController');
</code></pre>

<p>Con esos dos sencillos pasos conseguimos que nuestro controlador responda a las siguientes rutas/métodos</p>

<pre><code>Verbo   URL                 Nombre de la ruta  Acción
GET     /resource           resource.index     Listar varios
GET     /resource/create    resource.create    Formulario para crear
POST    /resource           resource.store     Guardar nuevo
GET     /resource/{id}      resource.show      Mostrar
GET     /resource/{id}/edit resource.edit      Formulario para editar
PUT     /resource/{id}      resource.update    Actualizar existente
DELETE  /resource/{id}      resource.destroy   Borrar o desactivar
</code></pre>

<p>Se puede limitar el número de métodos generados o las rutas aceptadas a solo un subconjunto de verbos</p>

<pre><code>artisan controller:make PhotoController --only=index,show
artisan controller:make PhotoController --except=index

Route::resource('photo', 'PhotoController', array('only' =&gt; array('index', 'show')));
Route::resource('photo', 'PhotoController', array('except' =&gt; array('create', 'store', 'update', 'delete')));
</code></pre>

<p><a href="#index">Volver al índice</a></p>

<p><a id="user_input"></a></p>

<h2>Datos de usuario</h2>

<p>No importa el verbo HTTP usado, para leer datos $<em>POST, $</em>GET y $_COOKIE se usa siempre la misma función</p>

<pre><code>$name = Input::get('name');
</code></pre>

<p>Si el dato no existe usar un valor de fallback</p>

<pre><code>$name = Input::get('name', 'Alfred');
</code></pre>

<p>Comprobar si se ha pasado un dato de usuario</p>

<pre><code>if (Input::has('name'))
{
    //
}
</code></pre>

<p>Obtener todos los datos pasados</p>

<pre><code>$input = Input::all();
</code></pre>

<p>Obtener solo algunos de los datos pasados</p>

<pre><code>$input = Input::only('username', 'password');
$input = Input::except('credit_card');
</code></pre>

<p><a href="#index">Volver al índice</a></p>

<p><a id="migrations"></a></p>

<h2>Migraciones</h2>

<p>Se guardan en <code>app/database/migrations</code> y suelen usar la sintaxis del <a href="http://laravel.com/docs/schema">contrstructor de esquemas de base de datos</a> de Laravel.</p>

<p>Para generar un archivo de migración con las funciones <code>up()</code> y <code>down()</code> vacías</p>

<pre><code>artisan migrate:make create_users_table
</code></pre>

<p>Para que además contenga el código para generar la tabla</p>

<pre><code>artisan migrate:make create_users_table --table=users --create #Además crea la tabla
</code></pre>

<p>Existe un <a href="#generators_migrations">generador de migraciones</a> más avanzado.</p>

<p>Todas las migraciones pendientes que se instalen en un mismo momento reciben un mismo número de <strong>lote</strong>. No es posible revertir (<em>rollback</em>) migraciones individualmente sino que se deben revertir por lotes o todas a la vez.</p>

<p>Para crear la tabla de migraciones</p>

<pre><code>artisan migrate:install
</code></pre>

<p>Para ejecutar todas las migraciones pendientes</p>

<pre><code>artisan migrate
</code></pre>

<p>Para deshacer las migraciones del último lote</p>

<pre><code>artisan migrate:rollback
</code></pre>

<p>Para deshacer todas las migraciones</p>

<pre><code>artisan migrate:reset
</code></pre>

<p>Para deshacer y volver a hacer de nuevo todas las migraciones</p>

<pre><code>artisan migrate:refresh
artisan migrate:refresh --seed
</code></pre>

<p><a href="#index">Volver al índice</a></p>

<p><a id="seeders"></a></p>

<h2>Sembradores</h2>

<p>Los sembradores o <em>seeders</em> sirven para insertar datos iniciales en la base de datos. Se definen en <code>app/database/seeds/</code> y su clase debe extender la clase <code>Seeder</code>. El nombre de la clase puede ser cualquier nobre de clase válido en PHP pero se considera buena práctica que el nombre incluya la tabla que <em>siembran</em> y terminen en <code>Seeder</code>.</p>

<p>Es posible <a href="#generators_seeds">generar los sembradores</a> con <code>artisan</code>.</p>

<p>Ejemplo de sembrador:</p>

<pre><code>class CountriesTableSeeder extends Seeder {

    public function run()
    {
        // Uncomment the below to wipe the table clean before populating
        // DB::table('countries')-&gt;truncate();

        $countries = array(
            ['name' =&gt; 'Spain', 'code' =&gt; 'es'],
            ['name' =&gt; 'France', 'code' =&gt; 'fr']
        );

        DB::table('countries')-&gt;insert($countries);
    }
}
</code></pre>

<p>Para indicar qué sembradores y en qué orden se deben ejecutar hay que añadirlos a la función <code>run()</code> del archivo <code>app/database/seeds/archivo/DatabaseSeeder.php</code></p>

<pre><code>class DatabaseSeeder extends Seeder {

    public function run()
    {
        $this-&gt;call('CountriesTableSeeder');
    }
}
</code></pre>

<p>Para ejecutar la siembra de datos</p>

<pre><code>artisan db:seed
</code></pre>

<p><a href="#index">Volver al índice</a></p>

<p><a id="models"></a></p>

<h2>Modelos y Eloquent ORM</h2>

<p>Los modelos sirven de pasarela de datos entre los <a href="#controllers">controladores</a> y las <a href="#views">vistas</a>. Se guardan en <code>app/models/</code> y para que puedan usar el ORM de Laravel deben extender de la clase <code>Eloquent</code>.</p>

<p>Ejemplo:</p>

<pre><code>class User extends Eloquent{
    ...
}
</code></pre>

<p>Es posible <a href="#generators_models">usar artisan para generar los modelos</a> por nosotros.</p>

<p><a id="model_attributes"></a></p>

<h3>Atributos</h3>

<p>Podemos usar algunos de los siguientes atributos de clase para modificar el comportamiento de un modelo.</p>

<p>Por defecto Laravel asume que el nombre de la tabla de base de datos para un modelo es la versión plurazidada del nombre del modelo. Si no es así se puede indicar el nombre de tabla con el siguiente atributo</p>

<pre><code>protected $table = 'tablename';
</code></pre>

<p>Si nuestra clave primaria no es del tipo <em>autoincrement</em> debemos usar el siguiente atributo para poder indicar valores de clave propios</p>

<pre><code>protected $incrementing = false;
</code></pre>

<p>Si el modelo usa <a href="#model_softdel">SoftDelete</a> indicarlo con el atributo</p>

<pre><code>protected $softDelete = true;
</code></pre>

<p>Si la tabla no tiene <em>timestamps</em> automáticos indicarlo con el atributo</p>

<pre><code>public $timestamps = false;
</code></pre>

<p>Cuando una ruta o un controlador devuelve un modelo la salida es convertida automáticamente a  JSON. Para indicar qué campos pueden ser incluidos en dicha salida</p>

<pre><code>protected $visible = array();
</code></pre>

<p>A la inversa, se puede indicar los campos que deben ser ocultados de la salida JSON</p>

<pre><code>protected $hidden = array();
</code></pre>

<p>Es posible indicar que al actualizar los timestamps de un modelo también se actualicen los timestamps de un modelo relacionado con el siguiente parámetro</p>

<pre><code>protected $touches = array('post'); //En este modelo debe existir un public function post() { return $this-&gt;belongsTo('Post'); }
</code></pre>

<p><a id="fillable"></a>Es posible <a href="#mass_assig">inicializar un modelo indicando el valor de las columnas como parámetros del constructor</a>. Para indicar qué parámetros son asignables en el constructor</p>

<pre><code>protected $fillable = array();
</code></pre>

<p>A la inversa, se puede indicar los campos que no pueden ser asignados desde el constructor</p>

<pre><code>protected $guarded = array('*'); // El asterisco sirve para bloquear la asignacion desde el constructor de todos los campos
</code></pre>

<p><a id="model_retrieve"></a></p>

<h3>Obtener datos</h3>

<p>Podemos usar cualquiera de las funciones del <a href="http://laravel.com/docs/queries">Query Builder</a> de Laravel para obtener datos con el ORM Eloquent. Si los datos obtenidos son más de uno Eloquent devuelve una colección.</p>

<p>Obtener un solo modelo a partir de su clave primaria</p>

<pre><code>$user = User::find(1);
</code></pre>

<p>Obtener un solo modelo a partir de su clave primaria y lanzar una excepción si no se encuentra</p>

<pre><code>$model = User::findOrFail(1);
</code></pre>

<p>Obtener una colección de todos los modelos de una tabla</p>

<pre><code>$users = User::all();
</code></pre>

<p>Obtener una colección de modelos que cumplan una condición</p>

<pre><code>$users = User::where('age', '&gt;', 30)-&gt;get();
</code></pre>

<p>Limitar el número de resultados en una colección</p>

<pre><code>$users = User::where('age', '&gt;', 30)-&gt;take(10)-&gt;get();
</code></pre>

<p>Saltarse un número de resultados en una colección</p>

<pre><code>$users = User::where('age', '&gt;', 30)-&gt;skip(10)-&gt;get();
</code></pre>

<p>Combinar <code>skip()</code> y <code>take()</code> para paginaciones personalizadas</p>

<pre><code>$users = User::where('age', '&gt;', 30)-&gt;forPage(2, 25)-&gt;get();
</code></pre>

<p>Obtener una colección de modelos y paginar los resultados con la paginación de Laravel (no hace falta indicar el número de página, Laravel lo detecta)</p>

<pre><code>$users = User::where('age', '&gt;', 30)-&gt;paginate(15);
</code></pre>

<p>Obtener solo ciertas columnas de una colección de modelos</p>

<pre><code>$users = User::where('active', '=', 1)-&gt;get(array('name','email','age'));
</code></pre>

<p>Obtener una sola columna de una colección de modelos</p>

<pre><code>$email = User::where('active', '=', 1)-&gt;pluck('name');
</code></pre>

<p>Incluir en la colección los modelos borrados con <a href="#model_softdel">SoftDelete</a></p>

<pre><code>$users = User::withTrashed()-&gt;get();
</code></pre>

<p>Incluir en la colección solo modelos borrados con <a href="#model_softdel">SoftDelete</a></p>

<pre><code>$users = User::onlyTrashed()-&gt;get();
</code></pre>

<p>Es posible indicar a mano la condición SQL</p>

<pre><code>$users = User::whereRaw('age &gt; ? and votes = 100', array(25))-&gt;get();
</code></pre>

<p><a id="model_aggregate"></a></p>

<h3>Funciones de agregación</h3>

<pre><code>$min = User::min('age');
$max = User::max('age');
$avg = User::avg('age');
$sum = User::sum('votes');
$count = User::where('age', '&gt;', 100)-&gt;count();
</code></pre>

<p><a id="model_store"></a></p>

<h3>Guardar nuevos datos</h3>

<p>Es posible indicar los datos individualmente...</p>

<pre><code>$user = new User;
$user-&gt;name = 'John';
$user-&gt;save();
</code></pre>

<p>... o en el constructor (respeta los <a href="#fillable">atributos</a> <code>$fillable</code>/<code>$guarded</code>).<a id="mass_assig"></a></p>

<pre><code>$user = new User(array('name' =&gt; 'John'));
$user-&gt;save();
</code></pre>

<p>También se puede hacer todo en una sola línea (respeta los <a href="#fillable">atributos</a> <code>$fillable</code>/<code>$guarded</code>).</p>

<pre><code>$user = User::create(array('name' =&gt; 'John'));
</code></pre>

<p>Cuardar un modelo y sus relaciones</p>

<pre><code>$user-&gt;name = 'Nick';
$user-&gt;address-&gt;street = 'Main avenue';
$user-&gt;push(); //Guarda tanto $user como $user-&gt;address
</code></pre>

<p><a id="model_update"></a></p>

<h3>Actualizar datos</h3>

<p>Actualizar una sola fila</p>

<pre><code>$user-&gt;name = 'John';
$user-&gt;save();
</code></pre>

<p>Actualizar algunas filas</p>

<pre><code>$affectedRows = User::where('votes', '&gt;', 100)-&gt;update(array('status' =&gt; 2));
</code></pre>

<p>Actualizar el timestamp</p>

<pre><code>$user-&gt;touch();
</code></pre>

<p>Incrementar o decrementar una columna</p>

<pre><code>User::whereRaw('birthday = DATE(NOW())')-&gt;increment(1);
Post::where('votes','&lt;','10')-&gt;decrement('karma');
</code></pre>

<p><a id="model_delete"></a></p>

<h3>Borrar datos</h3>

<p>Borrar una sola fila</p>

<pre><code>$user-&gt;delete();
</code></pre>

<p>Borrar por clave primaria</p>

<pre><code>User::destroy(1); //Una
User::destroy(1, 2, 3);//Más de una
User::destroy(array(1, 2, 3));//Más de una indicando con array
</code></pre>

<p>Borrar algunas</p>

<pre><code>$affectedRows = User::where('votes', '&gt;', 100)-&gt;delete();
</code></pre>

<p><a id="model_softdel"></a></p>

<h3>SoftDelete</h3>

<p>Si se activa el <em>softDelete</em> en un modelo, cuando <a href="#model_delete">borramos</a> datos de una tabla en realidad los datos no se eliminan sino que se marcan como borrados asignando a la columna <code>deleted_at</code> la fecha de borrado.</p>

<p>Comprobar si un dato ha sido borrado con <em>softDelete</em></p>

<pre><code>if ($user-&gt;trashed())
</code></pre>

<p>Candelar un <em>softDelete</em></p>

<pre><code>$user-&gt;restore();
</code></pre>

<p>Borrar definitivamente (No <em>softDelete</em>)</p>

<pre><code>$user-&gt;forceDelete();
</code></pre>

<p><a id="model_scope"></a></p>

<h3>Consultas con nombre</h3>

<p>Es posible asignar un nombre a una serie de consultas para poder reutilizarlas. Para ello solo hay que anteponer <code>scope</code> al nombre de la función. Ejemplo:</p>

<pre><code>public function scopePopular($query)
{
    return $query-&gt;where('votes', '&gt;', 100);
}

public function scopeWomen($query)
{
    return $query-&gt;whereGender('W');
}
</code></pre>

<p>Para usarlo</p>

<pre><code>$users = User::popular()-&gt;women()-&gt;orderBy('created_at')-&gt;get();
</code></pre>

<p>También se pueden definir <em>scopes</em> con parámetros</p>

<pre><code>public function scopeOfType($query, $type)
{
    return $query-&gt;whereType($type);
}
</code></pre>

<p>Para usarlo</p>

<pre><code>$users = User::ofType('member')-&gt;get();
</code></pre>

<p><a id="transactions"></a></p>

<h3>Transacciones</h3>

<p>Todo lo que se ejecute dentro de esta <em>closure</em> lo hará en una misma transacción. Si dentro de la función se lanza una excepción la transacción será revertida automáticamente.</p>

<pre><code>DB::transaction(function()
{
    // Consultas de BD
});
</code></pre>

<p>Para tener control manual de la transacción</p>

<pre><code>try {
    DB::beginTransaction();

    // Consultas de BD

    // Todo fue bien
    DB::commit();

} catch (\PDOException $e) {

    // Algo fue mal
    DB::rollBack();
}
</code></pre>

<p><a id="model_relationships"></a></p>

<h3>Definir relaciones</h3>

<p>Para definir una relación simplemente hay que crear una función que devuelva el resultado de uno de los métodos <code>hasOne</code>, <code>hasMany</code>, <code>belongsTo</code> o <code>belongsToMany</code>. El nombre de la función debe estar en notación <em>camelCase</em>, no <em>snake_case</em>.</p>

<p>Es posible acceder a las relaciones usando el nombre de la función, es decir, no es necesario usar ...</p>

<pre><code>Phone::find(1)-&gt;user()-&gt;first()-&gt;email;
Post::find(1)-&gt;comments()-&gt;get();
</code></pre>

<p>... sino que se puede usar ...</p>

<pre><code>Phone::find(1)-&gt;user-&gt;email;
Post::find(1)-&gt;comments;
</code></pre>

<p>... y Laravel invocará a <code>first()</code> o <code>get()</code> por nosotros dependiendo del tipo de relación.</p>

<p><a id="rel1-1"></a></p>

<h4>Relaciones uno a uno</h4>

<p>En un lado de la relación (el que no tiene clave ajena)</p>

<pre><code>class User extends Eloquent
{
    public function phone()
    {
        return $this-&gt;hasOne('Phone');
    }
}
</code></pre>

<p>En el otro lado de la relación (el que tiene la clave ajena))</p>

<pre><code>class Phone extends Eloquent
{
    public function user()
    {
        return $this-&gt;belongsTo('User');
    }
}
</code></pre>

<p>Si el nombre de la clave ajena es distinto podemos indicarlo con</p>

<pre><code>return $this-&gt;belongsTo('User', 'custom_key');
</code></pre>

<p>Para acceder a la relación en ambos sentidos</p>

<pre><code>$phone = User::find(1)-&gt;phone;
$user = Phone::find(1)-&gt;user;
</code></pre>

<p><a id="rel1-n"></a></p>

<h4>Relaciones uno a muchos</h4>

<p>En un lado de la relación</p>

<pre><code>class Post extends Eloquent
{
    public function comments()
    {
        return $this-&gt;hasMany('Comment');
    }
}
</code></pre>

<p>En el otro lado de la relación</p>

<pre><code>class Comment extends Eloquent
{
    public function post()
    {
        return $this-&gt;belongsTo('Post');
    }
}
</code></pre>

<p>Para usarlo</p>

<pre><code>$comments = Post::find(1)-&gt;comments;
$comments = Post::find(1)-&gt;comments()-&gt;where('title', '=', 'foo')-&gt;first();
</code></pre>

<p><a id="reln-m"></a></p>

<h4>Relaciones muchos a muchos</h4>

<p>En un lado de la relación</p>

<pre><code>class User extends Eloquent
{
    public function roles()
    {
        return $this-&gt;belongsToMany('Role');
    }
}
</code></pre>

<p>En el otro lado de la relación</p>

<pre><code>class Role extends Eloquent
{
    public function users()
    {
        return $this-&gt;belongsToMany('User');
    }
}
</code></pre>

<p>Si queremos incluir columnas extras de la tabla pivote usar</p>

<pre><code>return $this-&gt;belongsToMany('Role')-&gt;withPivot('foo', 'bar');
</code></pre>

<p>Si queremos que la tabla pivote mantega automáticamente los timestamps</p>

<pre><code>return $this-&gt;belongsToMany('Role')-&gt;withTimestamps();
</code></pre>

<p>Para usarlo</p>

<pre><code>$roles = User::find(1)-&gt;roles;
</code></pre>

<p>Para consultar columnas extras de la tabla pivote</p>

<pre><code>foreach ($user-&gt;roles as $role)
{
    echo $role-&gt;pivot-&gt;created_at;
}
</code></pre>

<p><a id="model_eager"></a></p>

<h3>Incluir relacionados en los resultados</h3>

<p>Incluir en los resultados de un modelo columnas de un modelo relacionado (<em>Eager Loading</em>)</p>

<pre><code>$books = Book::with('author')-&gt;get();
</code></pre>

<p>Incluir más de un modelo relacionado a la vez</p>

<pre><code>$books = Book::with('author', 'publisher')-&gt;get();
</code></pre>

<p>Incluir un modelo relacionado y a su vez uno de sus modelos relacioandos</p>

<pre><code>$books = Book::with('author.contacts')-&gt;get();
</code></pre>

<p>Incluir un modelo relacionado que cumpla una condición</p>

<pre><code>$books = Book::with(array('authors' =&gt; function($query)
{
    $query-&gt;where('country', '=', 'France');
}))-&gt;get();
</code></pre>

<p>Incluir un modelo relacionado de un modelo obtenido previamente (<em>Lazy Eager Loading</em>)</p>

<pre><code>$books = Book::all();
$books-&gt;load('author', 'publisher');
</code></pre>

<p>Obtener solo los modelos relacionados</p>

<pre><code>//Post con al menos un comentario
$posts = Post::has('comments')-&gt;get();
</code></pre>

<p>Obtener solo los modelos relacionados que cumplan una condición</p>

<pre><code>//Post con al menos 3 comentarios
$posts = Post::has('comments', '&gt;=', 3)-&gt;get();
</code></pre>

<p><a id="model_relate"></a></p>

<h3>Relacionar modelos</h3>

<p>Crear un nuevo objeto y relacionarlo con uno existente (funciona en relaciones 1-1, 1-N y N-M).</p>

<pre><code>//Anadir nuevo capítulo al libro 1
$chapter = new Chapter(array('title' =&gt; 'Nuevo capítulo'));
Book::find(1)-&gt;chapters()-&gt;save($chapter);

//Si la relacion es N-M podemos indicar valores de columnas extras de la tabla pivote
Book::find(1)-&gt;chapters()-&gt;save($chapter, array('expires' =&gt; $expires));
</code></pre>

<p>Actualizar la clave ajena en una relación 1-1 ó 1-N.</p>

<pre><code>//Cambiar el autor del libro 1
$author = User::find(2);
Book::find(1)-&gt;author()-&gt;associate($author)-&gt;save();
</code></pre>

<p>Relacionar dos objetos existentes en una relación N-M (no comprueba si ya existe en la tabla pivote)</p>

<pre><code>//Añadir el tag 2 al post 1
Post::find(1)-&gt;tags()-&gt;attach(2);

//Para indicar valores de columnas extras de la tabla pivote
Post::find(1)-&gt;tags()-&gt;attach(2, array('expires' =&gt; $expires));
</code></pre>

<p>Eliminar objetos relacionado en una relación N-M</p>

<pre><code>//Quitar el tag 2 del post 1
Post::find(1)-&gt;tags()-&gt;detach(2);

//Quitar todos  los tags del post 1
Post::find(1)-&gt;tags()-&gt;detach();
</code></pre>

<p>Reemplazar relacionados en una relación N-M (modifica de la tabla pivote para que solo contenga los indicados)</p>

<pre><code>Post::find(1)-&gt;tags()-&gt;sync(array(1, 2, 3));

//Para indicar valores de columnas extras de la tabla pivote
Post::find(1)-&gt;tags()-&gt;sync(array(1 =&gt; array('expires' =&gt; 1), 5 =&gt; array('expires' =&gt; 0)));
</code></pre>

<!-- to-do http://laravel.com/docs/eloquent#collections -->

<p><a href="#index">Volver al índice</a></p>

<p><a id="packages"></a></p>

<h2>Paquetes</h2>

<p>Laravel facilita la creación de paquetes propios que podemos publicar luego para que puedan ser instalados mediante <em>composer</em>.</p>

<p>Supongamos que queremos crear una librería para saludar.</p>

<p>Editar <code>app/config/workbench.php</code> y establecer nuestro nombre y dirección de correo.</p>

<p>Para generar el esqueleto de nuesto paquete ejecutar</p>

<pre><code>artisan workbench stolz/greeting --resources
</code></pre>

<p>El esqueleto del nuevo proyecto se encuentra en <code>workbench/stolz/greeting/</code>. Esta es la ruta que se subirá al <a href="https://packagist.org/">repositorio de composer</a> si decidimos publicar nuestro proyecto. En tal caso editar <code>workbench/stolz/greeting/composer.json</code> y completar los datos de nuestro paquete. Al acabar ejecutar <code>composer validate</code> para ver si todo está bien.</p>

<p>Todas nuestras clases deben estar en <code>workbench/stolz/greeting/src/Stolz/Greeting/</code>. Crear el fichero <code>workbench/stolz/greeting/src/Stolz/Greeting/Greeting.php</code> que contendrá la clase principal del paquete:</p>

<pre><code>&lt;?php namespace Stolz\Greeting;

class Greeting {

    public static function say_hello(){
        return "Hello";
    }
}
</code></pre>

<p>Crear una <em>facade</em> para poder usar nuestra clase con la sintaxis <code>Greeting::say_hello();</code>. Para ello crear el directorio <code>workbench/stolz/greeting/src/Stolz/Greeting/Facades/</code> y dentro de él crear el archivo <code>Greeting.php</code></p>

<pre><code>&lt;?php namespace Stolz\Greeting\Facades;

use Illuminate\Support\Facades\Facade;
use Illuminate\Foundation\AliasLoader;

class Greeting extends Facade {

    /**
    * Get the registered name of the component.
    *
    * @return string
    */
    protected static function getFacadeAccessor() { return 'greeting'; }
}
</code></pre>

<p>Registrar el <em>ServiceProvider</em> añadiendo a la functión <code>register</code> del archivo <code>workbench/stolz/greeting/src/Stolz/Greeting/GreetingServiceProvider.php</code> lo siguiente:</p>

<pre><code>$this-&gt;app['greeting'] = $this-&gt;app-&gt;share(function($app)
{
    return new Greeting;
});
</code></pre>

<p>Para evitar que el usuario tenga que añadir a mano la <em>facade</em> en el archivo <code>app/config/app.php</code> podemos usar la functión <code>boot</code> del archivo <code>workbench/stolz/greeting/src/Stolz/Greeting/GreetingServiceProvider.php</code> para incluir automáticamente el alias:</p>

<pre><code>AliasLoader::getInstance()-&gt;alias('Greeting', 'Stolz\Greeting\Facades\Greeting');
</code></pre>

<p>Actualizar las listas de clases autocargables para que incluyan nuestra nueva clase</p>

<pre><code>artisan dump-autoload
</code></pre>

<p>En <code>app/config/app.php</code> añadir el <em>ServiceProvider</em></p>

<pre><code>'providers' =&gt; array(
    'Stolz\Greeting\GreetingServiceProvider',
),
</code></pre>

<p>Probar nuestar clase con una ruta</p>

<pre><code>Route::get('test', function() {
    echo Greeting::say_hello();
});
</code></pre>

<p>Para más información consulta la <a href="http://laravel.com/docs/packages">documentación oficial</a>.</p>

<p><a href="#index">Volver al índice</a></p>

<p><a id="artisan"></a></p>

<h2>Artisan</h2>

<p>Artisan es el nombre de la interfaz de línea de comandos que se incluye con Laravel. Proporciona una serie de comandos útiles durante el desarrollo de la aplicación.</p>

<p>Establecer una clave segura para el cifrado</p>

<pre><code>artisan key:generate
</code></pre>

<p>Activar y desactivar el modo de mantenimiento</p>

<pre><code>artisan down
artisan up
</code></pre>

<p>Ver un resumen de todas las rutas defininas</p>

<pre><code>artisan routes
</code></pre>

<p>Actualizar las listas de clases autocargables</p>

<pre><code>artisan dump-autoload
</code></pre>

<p>Lanzar nuestra aplicación en el servidor web integrado en PHP</p>

<pre><code>artisan serve
</code></pre>

<p>Para generar un paquete</p>

<pre><code>artisan workbench stolz/greeting
artisan workbench stolz/greeting --resources
</code></pre>

<p>Copiar los assets de un paquete a <code>public/</code></p>

<pre><code>artisan asset:publish nombre/paquete
</code></pre>

<p>Copiar la configuración de un paquete a <code>app/config/</code></p>

<pre><code>artisan config:publish nombre/paquete
</code></pre>

<!--  to-do
                     Display the current framework environment
  migrate               Run the database migrations
  optimize              Optimize the framework for better performance
  tinker                Interact with your application
auth
  auth:reminders        Create a migration for the password reminders table
cache
  cache:clear           Flush the application cache
command
  command:make          Create a new Artisan command
db
  db:seed               Seed the database with records
migrate
  migrate:install       Create the migration repository
  migrate:make          Create a new migration file
  migrate:refresh       Reset and re-run all migrations
  migrate:reset         Rollback all database migrations
  migrate:rollback      Rollback the last database migration
queue
  queue:listen          Listen to a given queue
  queue:subscribe       Subscribe a URL to an Iron.io push queue
  queue:work            Process the next job on a queue
session
  session:table         Create a migration for the session database table
-->

<p><a id="generators"></a></p>

<h3>Generadores de código</h3>

<p>El paquete <a href="https://github.com/JeffreyWay/Laravel-4-Generators">Generators</a> es muy popular porque amplia considerablemente los comandos de artisan que sirven para generar código.</p>

<ul>
<li><a href="#generators_migrations">Generar migraciones</a>.</li>
<li><a href="#generators_models">Generar modelos</a>.</li>
<li><a href="#generators_controllers">Generar controladores</a>.</li>
<li><a href="#generators_views">Generar vistas</a>.</li>
<li><a href="#generators_forms">Generar formularios</a>.</li>
<li><a href="#generators_seeds">Generar sembradores</a>.</li>
</ul>

<p>Para los comandos que aceptan el parámetro <code>--fields</code> estos son algunos ejemplos de uso</p>

<pre><code>--fields="first:string, last:string"
--fields="age:integer, yob:date"
--fields="username:string:unique, age:integer:nullable"
--fields="name:string:default('John'), email:string:unique:nullable"
--fields="username:string[30]:unique, age:integer:nullable"
</code></pre>

<p><a id="generators_migrations"></a></p>

<h4>Generar migraciones</h4>

<p>El comando original de Laravel es muy limitiado en cuanto a generación de código</p>

<pre><code>artisan migrate:make create_users_table #Solo crea el fichero con las funciones up() y down()
artisan migrate:make create_users_table --table=users --create #Además crea la tabla
</code></pre>

<p>En cambio el de este paquete se genera mucho más código.</p>

<p>Crea tabla (Usar nombre que empiece por <em>create_</em> o <em>make_</em>.)</p>

<pre><code>artisan generate:migration create_users_table #similar al anterior pero con sintaxis más concisa
artisan generate:migration create_users_table --fields="name:string, age:integer"
</code></pre>

<p>Crear tabla pivot (no importa el orden alfabético de los nombres o si están en plural o no)</p>

<pre><code>artisan generate:pivot posts tags
</code></pre>

<p>Eliminar tabla (la segunda forma añade los campos a la función <code>down()</code> para el <em>rollback</em>)</p>

<pre><code>artisan generate:migration destroy_posts_table
artisan generate:migration destroy_posts_table --fields="title:string, body:text"
</code></pre>

<p>Añadir columnas (Usar nombre que empiece por <em>add_</em> o <em>insert_</em>)</p>

<pre><code>artisan generate:migration add_user_id_to_posts_table --fields="user_id:integer"
</code></pre>

<p>Eliminar columnas (Usar nombre que empiece por <em>remove_</em> o <em>drop_</em> o <em>delete_</em>. La segunda forma añade los campos a la función <code>down()</code> para el <em>rollback</em>)</p>

<pre><code>artisan generate:migration remove_age_from_users_table
artisan generate:migration remove_age_from_users_table --fields="age:integer"
</code></pre>

<p><a id="generators_models"></a></p>

<h4>Generar modelos</h4>

<p>Crear modelo</p>

<pre><code>artisan generate:model Model
</code></pre>

<p><a id="generators_controllers"></a></p>

<h4>Generar controladores</h4>

<p>El comando original para generar un <a href="#RESTful_controllers">controlador RESTful</a> genera las funciones vacías</p>

<pre><code>artisan controller:make PhotoController
artisan controller:make PhotoController --only=index,show
artisan controller:make PhotoController --except=index
</code></pre>

<p>En cambio, el de este paquete además se encarga de que las funciones carguen las vistas</p>

<pre><code>artisan generate:controller PhotoController
</code></pre>

<p>Se puede incluso generar <strong>con un solo comando</strong> el controlador, la migración, las vistas, el sembrador, la ruta y los test unitarios.</p>

<pre><code>artisan generate:resource photo --fields="title:string, taken:date"
</code></pre>

<p>O ir más lejos y además de lo anterior incluir más código como los formularios y sus validaciones, contenido de las vistas, consultas de BD ...</p>

<pre><code>artisan generate:scaffold photo --fields="title:string, taken:date"
</code></pre>

<p><a id="generators_views"></a></p>

<h4>Generar vistas</h4>

<p>Para generar <code>app/views/sample.blade.php</code></p>

<pre><code>artisan generate:view sample
</code></pre>

<p>Para generar <code>app/views/another/sample.blade.php</code></p>

<pre><code>artisan generate:view sample --path=views/another
</code></pre>

<p><a id="generators_forms"></a></p>

<h4>Generar formularios</h4>

<p>Para generar (en pantalla) una vista con un formulario basado en los atributos de un modelo existente</p>

<pre><code>artisan generate:form photo
artisan generate:form photo --method="update"
</code></pre>

<p>Para indicar la etiqueta que contendrá los campos del formulario</p>

<pre><code>artisan generate:form photo --html="div"
</code></pre>

<p><a id="generators_seeds"></a></p>

<h4>Generar sembradores</h4>

<p>Para generar un sembrador</p>

<pre><code>artisan generate:seed Countries
</code></pre>

<!-- to-do

    artisan generate:test         Generate a PHPUnit test class.
-->

<p><a href="#index">Volver al índice</a></p>

</body>
</html>

